<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>我的技术与生活——shell编程 | Mr.Long</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="shortcut icon" href="/imgs/shortcut-icon.ico" type="image/x-icon">
  <link rel="stylesheet" href="/css/public.css" />
  <link rel="stylesheet" href="/css/layout.css" />
  <link rel="stylesheet" href="/css/iconfont.css" />
  <link rel="stylesheet" href="/css/APlayer.min.css" />
  <script src="/js/APlayer.min.js"></script>
  <script src="/js/jquery.min.js"></script>
  <script src="/js/jquery.pjax.min.js"></script>

  <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
  <script>
    document.title = `我的技术与生活——shell编程`
  </script>
<meta name="generator" content="Hexo 7.3.0"></head>

<style>
  .load {
    width: 100%;
    height: 100vh;
    background-color: rgb(37, 35, 40);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    position: relative;
    z-index: 9999;
  }
  .load-circle {
    width: 80px;
    height: 80px;
    border: 8px solid orange;
    border-bottom-color: transparent;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    animation: rotate 1s linear infinite;
    filter: drop-shadow(0 0 3px orange);
  }
  .load-circle-inner {
    width: 40px;
    height: 40px;
    border: 8px solid orange;
    border-top-color: transparent;
    border-radius: 50%;
    animation: rotate-reverse .5s linear infinite;
  }
  .load-text {
    margin-top: 20px;
    font-size: 24px;
    color: orange;
    display: flex;
  }
  .load-text span {
    margin: 0 5px;
    text-shadow: 5px 5px 5px orange;
    animation: move 1s linear infinite;
  }
  .load-text span:nth-child(1) {
    animation-delay: -0.6s;
  }
  .load-text span:nth-child(2) {
    animation-delay: -0.5s;
  }
  .load-text span:nth-child(3) {
    animation-delay: -0.4s;
  }
  .load-text span:nth-child(4) {
    animation-delay: -0.3s;
  }
  .load-text span:nth-child(5) {
    animation-delay: -0.2s;
  }
  .load-text span:nth-child(6) {
    animation-delay: -0.1s;
  }
  @keyframes rotate {
    0% { transform: rotate(0); }
    100% { transform: rotate(360deg); }
  }
  @keyframes rotate-reverse {
    0% { transform: rotate(0); }
    100% { transform: rotate(-360deg); }
  }
  @keyframes move {
    0% { transform: translateY(0%) rotate(0) scale(1); }
    20% { transform: translateY(20%) rotate(10deg) scale(1.2); }
    80% { transform: translateY(-10%) rotate(-20deg) scale(.8);}
    100% { transform: translateY(0) rotate(0) scale(1); }
  }

  .progress {
    position: fixed;
    left: 0; top: 0;
    width: 0;
    height: 3px;
    background-color: green;
    transition: all cubic-bezier(0.215, 0.610, 0.355, 1) .1s;
    z-index: 9999;
  }

  .to-up {
    animation: toUp .5s 1;
  }
  .gray {
    position: fixed;
    left: 0;
    top: 0;
    width: 100%;
    height: 100vh;
    z-index: 9999;
    display: none;
    pointer-events: none;
    background-color: #000;
    mix-blend-mode: color;
  }
  @keyframes toUp {
    from { transform: translateY(15px); opacity: 0; }
    to { transform: translateY(0) ; opacity: 1; }
  }
</style>
<body>
  <div id="load" class="load">
    <div class="load-circle">
      <div class="load-circle-inner"></div>
    </div>
    <p class="load-text">
      <span>L</span>
      <span>O</span>
      <span>A</span>
      <span>D</span>
      <span>I</span>
      <span>N</span>
      <span>G</span>
    </p>
  </div>
  <div id="container" class="container w-100 vh-100" style="display: none;">
    <header class="header">
  <div class="header-wrapper">
    <div class="header-left">
      <div class="header-search">
        <input id="search-input" type="text" class="header-search--input" placeholder="请输入要检索的文章标题" />
        <span id="search-btn" class="header-search--icon"><i class="iconfont icon-sousuo"></i></span>
      </div>
      <div id="search-layer" class="header-search--layer hidden">
        <p class="title">
          <span>以下是搜索内容：</span>
          <span id="close-layer-btn">关闭</span>
        </p>
        <ul>
        </ul>
      </div>
    </div>
    <div class="header-right">
      <ul class="header-menu">
        <li>
          <a href="http://example.com/">
            <i class="header-menu--icon iconfont icon-shouye"></i>
            <span class="header-menu--span">首页</span>
          </a>
        </li>
        <li>
          <a href="http://example.com/log">
            <i class="header-menu--icon iconfont icon-rizhi"></i>
            <span class="header-menu--span">日志</span>
          </a>
        </li>
        <li>
          <a href="http://example.com/link">
            <i class="header-menu--icon iconfont icon-youqinglianjie"></i>
            <span class="header-menu--span">友情链接</span>
          </a>
        </li>
        <li>
          <a href="http://example.com/about">
            <i class="header-menu--icon iconfont icon-guanyuwomen"></i>
            <span class="header-menu--span">关于我</span>
          </a>
        </li>
      </ul>
    </div>
  </div>
</header>

<script>
  const ipt = document.querySelector('#search-input')
  const btn = document.querySelector('#search-btn')
  const layer = document.querySelector('#search-layer')
  const posts = JSON.parse(`[{"title":"docker命令","cover":"https://haowallpaper.com/link/common/file/getCroppingImg/71e27d1e01da8c13f3f165a1c3bcc8b571e27d1e01da8c13f3f165a1c3bcc8b5","path":"2024/02/21/Docker命令大全/"},{"title":"LV移除、缩容","cover":"https://haowallpaper.com/link/common/file/getCroppingImg/d733537fd3e06784932826b5e82a855d","path":"2023/06/21/LV逻辑卷扩展/"},{"title":"LVM逻辑卷管理","cover":"https://haowallpaper.com/link/common/file/getCroppingImg/d733537fd3e06784932826b5e82a855d","path":"2023/06/28/LVM逻辑卷管理 /"},{"title":"PXE+Kickstart无人值守安装操作系统","cover":"https://haowallpaper.com/link/common/file/getCroppingImg/82cb48f718f8acc8cb2568140eeaaec382cb48f718f8acc8cb2568140eeaaec3","path":"2023/06/26/PXE+Kickstart无人值守安装操作系统/"},{"title":"python一","cover":"https://haowallpaper.com/link/common/file/getCroppingImg/15096963228077376","path":"2024/05/20/Python 1 /"},{"title":"python三","cover":"https://haowallpaper.com/link/common/file/getCroppingImg/15096963228077376","path":"2024/05/25/Python 3/"},{"title":"TCP协议","cover":"https://haowallpaper.com/link/common/file/getCroppingImg/15047394039467328","path":"2023/06/21/TCP协议/"},{"title":"python二","cover":"https://haowallpaper.com/link/common/file/getCroppingImg/15096963228077376","path":"2024/05/20/Python 2/"},{"title":"docker容器","cover":"https://haowallpaper.com/link/common/file/getCroppingImg/71e27d1e01da8c13f3f165a1c3bcc8b571e27d1e01da8c13f3f165a1c3bcc8b5","path":"2024/02/11/docker容器/"},{"title":"python四","cover":"https://haowallpaper.com/link/common/file/getCroppingImg/15096963228077376","path":"2024/05/30/Python 4/"},{"title":"FTP文件服务器","cover":"https://haowallpaper.com/link/common/file/getCroppingImg/a9045286aa9b50dcc09302eff83b328a","path":"2023/06/23/ftp/"},{"title":"用户文件权限","cover":"https://haowallpaper.com/link/common/file/getCroppingImg/3719037aa1a43c4806d84ac9bd3dbc34","path":"2023/06/21/文件权限/"},{"title":"shell编程","cover":"https://haowallpaper.com/link/common/file/getCroppingImg/9217d5c6d87ce0e8ec7422ca7469db95","path":"2023/07/21/shell_newrain/"},{"title":"ansible模块","cover":"https://haowallpaper.com/link/common/file/getCroppingImg/1e624a7ba7e09f195b3f2f384b2b9bb1","path":"2023/09/17/ansible 模块扩展/"},{"title":"单用户模式破解密码","cover":"https://haowallpaper.com/link/common/file/getCroppingImg/3f6ae566e1f093d2d9dbcc3df361fc4b3f6ae566e1f093d2d9dbcc3df361fc4b","path":"2023/07/01/破解密码/"},{"title":"linux文件管理","cover":"https://haowallpaper.com/link/common/file/getCroppingImg/de0f7b079a80d192f90989d9c2c9622d","path":"2023/06/21/文件管理/"},{"title":"磁盘阵列","cover":"https://haowallpaper.com/link/common/file/getCroppingImg/69d9906ff9bf88dbc02184ecb8504fc5","path":"2023/07/11/磁盘阵列RAID/"},{"title":"自建YUM源","cover":"https://haowallpaper.com/link/common/file/getCroppingImg/56260873f5720f373c20f43587eab0b8","path":"2023/06/21/自建yum源笔记/"},{"title":"Linux网卡","cover":"https://haowallpaper.com/link/common/file/getCroppingImg/346f59e468f2155074d1fb3164594702","path":"2023/06/21/网络管理基础/"},{"title":"存储管理--1","cover":"https://haowallpaper.com/link/common/file/getCroppingImg/d733537fd3e06784932826b5e82a855d","path":"2023/06/19/磁盘存储管理1/"},{"title":"走进网络世界","cover":"https://haowallpaper.com/link/common/file/getCroppingImg/583716b0cb306203c308cc0def55dd9e583716b0cb306203c308cc0def55dd9e","path":"2023/06/20/走进网络世界/"}]`)
  ipt.addEventListener('keyup', e => {
    if (e.key === 'Enter') {
      handleSearch()
    }
  })
  btn.addEventListener('click', () => {
    handleSearch()
  })

  document.querySelector('#close-layer-btn').addEventListener('click', () => {
    layer.classList.toggle('hidden')
  })

  function handleSearch() {
    if (ipt.value.trim() === '') {
      return
    }
    let html = ''
    const targetPosts = posts.filter(post => post.title.includes(ipt.value))
    targetPosts.forEach(post => {
      html += `
        <li>
          <div>
            <a href="/${post.path}">${post.title.replace(new RegExp(ipt.value), `<span>${ipt.value}</span>`)}</a>
          </div>
          <img src="${post.cover || '/imgs/default-cover.webp' }" />
        </li>
      `
    })
    if (html.trim () === '') {
      html += '<p class="empty">没有搜索到内容</p>'
    }
    layer.querySelector('ul').innerHTML = html
    layer.classList.remove('hidden')
  }
</script> 
    <section id="main" class="main">
      <div class="main-left-wrapper">
<div class="main-left">
  <div class="main-left--block">
    <div class="main-left--info">
      <img src="/imgs/avatar.jpg"" class="main-left--avatar" />
      <div class="main-left--intro">
        <p class="main-left--name">Mr.Long</p>
        <div class="main-left--tags">
          <span class="main-left--tag">唱跳rap篮球</span>
          <span class="main-left--tag">宅但不肥</span>
        </div>
      </div>
    </div>
  
    <div>
      <div class="main-left--motto">
        <p>“花有重开日，人无再少年”</p>
        <p>“一个简单普通的男孩”</p>
      </div>
      <div class="main-left--github">
        <span class="line"></span>
        <a target="_blank" rel="noopener" href="https://github.com/MyRong99/MyRong99.github.io"><i class="logo iconfont icon-github-fill"></i></a>
        <span class="line"></span>
      </div>
      <div class="main-left--statics">
        <a href="/categories">
          <div>
            <span>6</span>
            <span>分类</span>
          </div>
        </a>
        <a href="/tags">
          <div>
            <span>6</span>
            <span>标签</span>
          </div>
        </a>
        <a href="/archives">
          <div>
            <span>5 </span>
            <span>归档</span>
          </div>
        </a>
      </div>
    </div>
  </div>

  <div class="main-left--block">
    <ul class="main-left--menu">
      
        <li>
          <a href="/">
            <span class="header-menu--span">小站首页</span>
            <i class="header-menu--icon iconfont icon-shouye"></i>
          </a>
        </li>
      
        <li>
          <a href="/log">
            <span class="header-menu--span">个人日志</span>
            <i class="header-menu--icon iconfont icon-rizhi"></i>
          </a>
        </li>
      
        <li>
          <a href="/link">
            <span class="header-menu--span">友情链接</span>
            <i class="header-menu--icon iconfont icon-youqinglianjie"></i>
          </a>
        </li>
      
        <li>
          <a href="/about">
            <span class="header-menu--span">关于自己</span>
            <i class="header-menu--icon iconfont icon-guanyuwomen"></i>
          </a>
        </li>
      
        <li>
          <a href="/tools">
            <span class="header-menu--span">我的工具</span>
            <i class="header-menu--icon iconfont icon-gongju"></i>
          </a>
        </li>
      
    </ul>
  </div>

  <div class="main-left--block">
    <div class="main-left--site">
      <h5 class="main-left--title">
        <span>站点信息</span>
        <i class="iconfont icon-zhandian"></i>
      </h5>
      <p class="main-left--subtitle">
        <span>文章数目：</span>
        <span>21 篇</span>
      </p>
      <p class="main-left--subtitle">
        <span>最近动态：</span>
        <span>今天</span>
      </p>
      <p class="main-left--subtitle">
        <span>上线时间：</span>
        <span>394天</span>
      </p>
      <p class="main-left--subtitle">
        <span>当前版本：</span>
        <span>v1.0.2</span>
      </p>
    </div>
  </div>
</div></div>
      <div id="main-container" class="main-container">


  <link rel="stylesheet" href="/css/partial/article.css" />

<div class="article-container">
  <div class="article">
    <h1 class="article-title">shell编程</h1>
    <div class="article-info">
      <div class="article-info--item">
        <div class="article-info--info">
          
          <div class="article-info--categories">
            <span>分类：</span>
            <a class="category-link" href="/categories/SHELL/">-SHELL</a>
          </div>
          
          
          <div class="article-info--tags">
            <span>标签：</span>
            <a class="tag-link" href="/tags/SHELL/" rel="tag">-SHELL</a>
          </div>
          
          <p class="article-info--date">日期：2023-07-21 22:19:22</p>
        </div>
        <img src="https://haowallpaper.com/link/common/file/getCroppingImg/9217d5c6d87ce0e8ec7422ca7469db95" alt="" class="article-cover">
      </div>
    </div>
    <article class="article-content markdown-body">
      <h1 id="shell编程"><a href="#shell编程" class="headerlink" title="shell编程"></a>shell编程</h1><h3 id="一、初识shell"><a href="#一、初识shell" class="headerlink" title="一、初识shell"></a>一、初识shell</h3><ul>
<li>程序 语言 编程</li>
<li>语言 <ul>
<li>自然语言 <ul>
<li>汉语 英语</li>
</ul>
</li>
<li>计算机语言 <ul>
<li>c语言</li>
<li>c++</li>
<li>java php python go shell</li>
</ul>
</li>
<li>编译型语言 c c++ java</li>
<li>解释型语言  php python  bash</li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">编译型语言:运行编译型语言是相对于解释型语言存在的，编译型语言的首先将源代码编译生成机器语言，再由机器运行机器码(二进制)。像C/C++等都是编译型语言。 </span><br><span class="line">解释型语言:相对于编译型语言存在的，源代码不是直接翻译成机器语言，而是先翻译成中间代码，再由解释器对中间代码 进行解释运行。比如Python/JavaScript / Perl /Shell等都是解释型语言</span><br><span class="line">    c 编译型执行 代码需要编译成cpu能认识的二进制码 x86指令集</span><br><span class="line">    java 编译型执行 ， 编译--&gt;字节码，cpu不能直接运行，只能被Java虚拟机执行 </span><br><span class="line">    shell 解释型执行 慢</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdn.net/20180802084112768?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTIxODQ1Mzk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70#id=lOTn4&originHeight=153&originWidth=602&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title="><img src="https://img-blog.csdn.net/20180802084124396?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTIxODQ1Mzk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70#id=FRVRZ&originHeight=192&originWidth=617&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title="></p>
<h5 id="shell-定义"><a href="#shell-定义" class="headerlink" title="shell 定义"></a>shell 定义</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Shell 也是一种程序设计语言，它有变量，关键字，各种控制语句，有自己的语法结构，利用shell程序设计语 可以编写功能很强、代码简短的程序</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">! Shebang 定义解释器</span></span><br></pre></td></tr></table></figure>

<h5 id="shell的分类和切换"><a href="#shell的分类和切换" class="headerlink" title="shell的分类和切换"></a>shell的分类和切换</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@newrain ~]# cat /etc/shells </span><br><span class="line">/bin/sh</span><br><span class="line">/bin/bash</span><br><span class="line">/sbin/nologin</span><br><span class="line">/usr/bin/sh</span><br><span class="line">/usr/bin/bash</span><br><span class="line">/usr/sbin/nologin</span><br><span class="line"></span><br><span class="line">默认shell： bash shell</span><br><span class="line">centos中脚本使用的默认shell 为/usr/bin/sh  </span><br><span class="line">查看当前正在使用的shell</span><br><span class="line">echo $SHELL</span><br><span class="line">shell 的切换</span><br><span class="line">vim /etc/passwd  编辑登录shell</span><br></pre></td></tr></table></figure>

<h5 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">什么时候不适合使用Shell编程:</span><br><span class="line">    1. 资源紧张的项目，特别是那些速度是重要因素的地方(排序，散序，等等)</span><br><span class="line">    2. 程序要进行很复杂的数学计算，特别是浮点计算，任意精度的计算，或者是复数计算</span><br><span class="line">    3. 要求交叉编译平台的可移植性(使用C或者是Java代替)</span><br><span class="line">    4. 需要结构化编程的复杂应用(需要变量类型检查和函数原型等等)</span><br><span class="line">    5. 对于影响系统全局性的关键任务应用。</span><br><span class="line">    6. 安全非常重要。你必须保证系统完整性和抵抗入侵，攻击和恶意破坏。</span><br><span class="line">    7. 项目由连串的依赖的各个部分组成。</span><br><span class="line">    8. 多种文件操作要求(Bash被限制成文件顺序存取，并且是以相当笨拙，效率低下的逐行的存取方式) 9. 需要良好的多维数组支持。</span><br><span class="line">    10. 需要类似链表或树这样的数据结构。</span><br><span class="line">    11. 需要产生或操作图象或图形用户界面。</span><br><span class="line">    12. 需要直接存取系统硬件。</span><br><span class="line">    13. 需要端口号或是socket I/O。</span><br><span class="line">    14. 需要使用可重用的函数库或接口。</span><br><span class="line">    15. 所有的私有的不开源的应用程序(Shell脚本的源代码是直接可读，能被所有人看到的)</span><br><span class="line"></span><br><span class="line">		如果你需要有上面的任意一种应用，请考虑其他的更强大的脚本语言――Perl,Tcl,Python,Ruby，或者可能是其他更 高级的编译型语言，例如C，C++或者是Java</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Shell 能做什么?</span><br><span class="line">1. 自动化批量系统初始化程序 (update，软件安装，时区设置，安全策略...)</span><br><span class="line">2. 自动化批量软件部署程序 (LAMP，LNMP，Tomcat，LVS，Nginx)</span><br><span class="line">3. 应用管理程序 (KVM，集群管理扩容，MySQL，DELLR720批量RAID)</span><br><span class="line">4. 日志分析处理程序(PV, UV, 200, !200, top 100, grep/awk)</span><br><span class="line">5. 自动化备份恢复程序(MySQL完全备份/增量 + Crond)</span><br><span class="line">6. 自动化管理程序(批量远程修改密码，软件升级，配置更新)</span><br><span class="line">7. 自动化信息采集及监控程序(收集系统/应用状态信息，CPU,Mem,Disk,Net,TCP Status,Apache,MySQL) 8. 配合Zabbix信息采集(收集系统/应用状态信息，CPU,Mem,Disk,Net,TCP Status,Apache,MySQL)</span><br><span class="line">8. 自动化扩容(增加云主机——&gt;业务上线)</span><br><span class="line">zabbix监控CPU 80%+|-50% Python API AWS/EC2(增加/删除云主机) + Shell Script(业务上 线)</span><br><span class="line">9. 俄罗斯方块，打印三角形，打印圣诞树，打印五角星，运行小火车，坦克大战，排序实现 </span><br><span class="line">10. Shell可以做任何运维的事情(一切取决于业务需求)</span><br></pre></td></tr></table></figure>

<h5 id="shell-特性回顾"><a href="#shell-特性回顾" class="headerlink" title="shell 特性回顾"></a>shell 特性回顾</h5><ul>
<li>shell常见元素</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">文件描述符与输出重定向:</span><br><span class="line">在 shell 程式中，最常使用的 FD (file descriptor) 大概有三个, 分别是: </span><br><span class="line">0: Standard Input (STDIN)</span><br><span class="line">1: Standard Output (STDOUT)</span><br><span class="line">2: Standard Error Output (STDERR)</span><br><span class="line">在标准情况下, 这些FD分别跟如下设备关联:</span><br><span class="line">stdin(0): keyboard 键盘输入,并返回在前端</span><br><span class="line">stdout(1): monitor 正确返回值 输出到前端</span><br><span class="line">stderr(2): monitor 错误返回值 输出到前端</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">a.txt</span></span><br><span class="line"><span class="meta prompt_">1&gt;</span><span class="language-bash">a.txt</span></span><br><span class="line"><span class="meta prompt_">2&gt;</span><span class="language-bash">a.txt</span></span><br><span class="line">&amp;&gt;a.txt</span><br><span class="line"><span class="meta prompt_">1&gt;</span><span class="language-bash">&amp;2</span></span><br><span class="line"><span class="meta prompt_">2&gt;</span><span class="language-bash">&amp;1</span></span><br><span class="line">一般来说, &quot;1&gt;&quot; 通常可以省略成 &quot;&gt;&quot;.</span><br><span class="line"><span class="meta prompt_">1&gt;</span><span class="language-bash">&amp;2 正确返回值传递给2输出通道 &amp;2表示2输出通道，之前如果有定义标准错误重定向到某<span class="built_in">log</span>文件,那么标准输出也重 定向到这个<span class="built_in">log</span>文件，如果此处错写成 1&gt;2, 就表示把1输出重定向到文件2中.</span></span><br><span class="line"><span class="meta prompt_">2&gt;</span><span class="language-bash">&amp;1 错误返回值传递给1输出通道, 同样&amp;1表示1输出通道.</span></span><br><span class="line">例子. 当前目录下只有a.txt,没有b.txt</span><br><span class="line">[root@redhat box]# ls a.txt b.txt 1&gt;file.out 2&gt;&amp;1</span><br><span class="line">[root@redhat box]# cat file.out</span><br><span class="line">ls: b.txt: No such file or directory</span><br><span class="line">a.txt</span><br><span class="line">现在, 正确的输出和错误的输出都定向到了file.out这个文件中, 而不显示在前端 =================================</span><br><span class="line">[root@redhat tmp]# cat &gt;&gt; b.txt &lt;&lt; !</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">ni hao a hahafvs</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">!</span></span><br><span class="line">[root@redhat tmp]# cat b.txt</span><br><span class="line">ni hao a haha</span><br></pre></td></tr></table></figure>

<h5 id="bash-初始化"><a href="#bash-初始化" class="headerlink" title="bash 初始化"></a>bash 初始化</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">用户登录时相关的bash配置文件 (登录脚本)</span><br><span class="line">全局配置文件</span><br><span class="line">  /etc/profile </span><br><span class="line">  /etc/profile.d/*.sh </span><br><span class="line">  /etc/bashrc</span><br><span class="line">个人配置文件</span><br><span class="line">  ~/.bash_profile</span><br><span class="line">  ~/.bashrc</span><br><span class="line">profile类的文件: 设定环境变量</span><br><span class="line">	运行命令或脚本</span><br><span class="line">bashrc类的文件: </span><br><span class="line">	定义命令别名</span><br><span class="line">用户登录时加载bash配置文件的过程</span><br><span class="line">登录式shell加载配置文件过程</span><br><span class="line">	~/.bash_profile --&gt; ~/.bashrc --&gt; /etc/bashrc	 --&gt; /etc/profile --&gt; /etc/profile.d/*.sh</span><br><span class="line">	</span><br><span class="line">非登录式shell加载配置文件过程</span><br><span class="line">		~/.bashrc --&gt; /etc/bashrc --&gt; /etc/profile.d/*.sh</span><br><span class="line">用户的初始化脚本</span><br><span class="line">		环境变量 修饰用户工作环境变量</span><br><span class="line">这些文件为系统的每个用户设置环境信息Shell设置文件:</span><br><span class="line">		/etc/profile(系统级)启动时执行 </span><br><span class="line">		这是系统最主要的shell设置文件，也是用户登陆时系统最先检查的文件，有关重要的环境变量都定义在此，其中包括 PATH,USER,LOGNAME,MAIL,HOSTNAME,HISTSIZE,INPUTRC等。而在文件的最后，它会检查并执 行/etc/profile.d/*.sh的脚本。</span><br><span class="line">		~/.bash_profile(用户级)离开时执行 </span><br><span class="line">		这个文件是每位用户的bash环境设置文件，它存在与于用户的主目录中，当系统执行/etc/profile 后，就会接着读取此 文件内的设置值。在此文件中会定义USERNAME,BASH_ENV和PATH等环境变量，但是此处的PATH除了包含系统的$PATH变 量外加入用户的“bin”目录路径.</span><br><span class="line">		~/.bashrc(用户级)离开时执行</span><br><span class="line">		接下来系统会检查~.bashrc文件，这个文件和前两个文件(/etc/profile 和~.bash_profile)最大的不同是，每次 执行bash时，~.bashrc都会被再次读取，也就是变量会再次地设置，而/etc/profile,~./bash_profile只有在登陆 时才读取。就是因为要经常的读取，所以~/.bashrc文件只定义一些终端机设置以及shell提示符号等功能，而不是定义环 境变量。</span><br><span class="line">		~/.bash_login(用户级)离开时执行 </span><br><span class="line">		如果~.bash_profile文件不存在，则系统会转而读取~.bash_login这个文件内容。这是用户的登陆文件，在每次用户登 陆系统时，bash都会读此内容，所以通常都会将登陆后必须执行的命令放在这个文件中。</span><br><span class="line">		~/.bash_logout 离开时执行 如果想在注销shell前执行一些工作，都可以在此文件中设置。 例如:</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">vi ~/.bash_logout</span></span><br><span class="line">clear</span><br><span class="line">仅执行一个clear命令在你注销的时候</span><br><span class="line"></span><br><span class="line">		~/.bash_history(用户级) </span><br><span class="line">		这个文件会记录用户先前使用的历史命令。</span><br></pre></td></tr></table></figure>

<ul>
<li>图形模式登录时，顺序读取：&#x2F;etc&#x2F;profile 和 ~&#x2F;.profile </li>
<li>图形模式登录后，打开终端时，顺序读取：&#x2F;etc&#x2F;bash.bashrc 和 ~&#x2F;.bashrc </li>
<li>文本模式登录时，顺序读取：&#x2F;etc&#x2F;bash.bashrc，&#x2F;etc&#x2F;profile 和 ~&#x2F;.bash_profile </li>
<li>从其它用户 su 到该用户，则分两种情况： <ul>
<li>如果带 -l 参数（或-参数，–login 参数），如：su -l username，则 bash 是 login 的，它将顺序读取以下配置文件：&#x2F;etc&#x2F;bash.bashrc，&#x2F;etc&#x2F;profile 和~&#x2F;.bash_profile。</li>
<li>如果没有带 -l 参数，则 bash 是 non-login 的，它将顺序读取：&#x2F;etc&#x2F;bash.bashrc 和 ~&#x2F;.bashrc</li>
</ul>
</li>
<li>注销时，或退出 su 登录的用户，如果是 longin 方式，那么 bash 会读取：~&#x2F;.bash_logout <ul>
<li>执行自定义的 Shell 文件时，若使用 bash -l a.sh 的方式，则 bash 会读取行：&#x2F;etc&#x2F;profile 和 ~&#x2F;.bash_profile，若使用其它方式，如：bash a.sh，.&#x2F;a.sh，sh a.sh（这个不属于bash Shell），则不会读取上面的任何文件。</li>
<li>上面的例子凡是读取到 ~&#x2F;.bash_profile 的，若该文件不存在，则读取 ~&#x2F;.bash_login，若前两者不存在，读取 ~&#x2F;.profile。</li>
</ul>
</li>
<li>bash shell 特性</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">补全   bash-completion # 增加补全</span><br><span class="line">历史   history</span><br><span class="line">别名   alias</span><br><span class="line">快捷键    </span><br><span class="line">前后台作业  fg  dg  curl + z    kill -19 暂停到后台</span><br><span class="line">重定向</span><br><span class="line">管道</span><br><span class="line">命令排序执行</span><br><span class="line">; &amp;&amp; || </span><br><span class="line">; 命令分割，在一行中执行多条语句</span><br><span class="line">&amp;&amp; 一行中执行多条语句，前成功后面再执行</span><br><span class="line">|| 一行中执行多条语句，前面不成功，后面再执行</span><br><span class="line">通配符</span><br><span class="line">&#123;&#125; ?*</span><br><span class="line">正则表达式 脚本</span><br></pre></td></tr></table></figure>

<ul>
<li>历史命令</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">查看历史命令</span><br><span class="line">		history 						/etc/profile 下的historysize 可以修改</span><br><span class="line">调用历史命令 	</span><br><span class="line">    上下健</span><br><span class="line">    !关键字</span><br><span class="line">    !历史命令行号</span><br><span class="line">    !! 执行上一条命令</span><br><span class="line">    !$ 上一条命令的最后一个参数</span><br><span class="line">			esc . 上一条命令的最后一个参数</span><br><span class="line">			Ctrl+r 在历史命令中查找，输入关键字调出之前的命令 </span><br><span class="line">			关键字+pgup/phdn 可以切换关键字相关的历史命令</span><br><span class="line">别名</span><br><span class="line">		查看别名</span><br><span class="line">			alias</span><br><span class="line">		设置别名 </span><br><span class="line">			临时设置</span><br><span class="line">      # aa=88</span><br><span class="line">      # echo $aa</span><br><span class="line">		永久设置</span><br><span class="line">      # vim /root/.bashrc</span><br><span class="line">小小技巧:显示历史命令执行时间 </span><br><span class="line">		1.设置变量:</span><br><span class="line">			HISTTIMEFORMAT=&quot;%Y-%m-%d %H:%M:%S&quot; </span><br><span class="line">		2.再次执行history查看结果</span><br></pre></td></tr></table></figure>

<ul>
<li>Bash 部分快捷键</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Ctrl+a 切换到命令行开始(跟home一样，但是home在某些unix环境下无法使用) 			</span><br><span class="line">Ctrl+e 切换到命令行末尾</span><br><span class="line">Ctrl+u 清除剪切光标之前的内容</span><br><span class="line">Ctrl+k 清除剪切光标之后的内容</span><br><span class="line">ctrl+y 粘贴刚才所删除的字符</span><br><span class="line">Ctrl+r 在历史命令中查找，输入关键字调出之前的命令</span><br></pre></td></tr></table></figure>

<ul>
<li>通配符置换</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">在 Shell命令中，通常会使用通配符表达式来匹配一些文件</span><br><span class="line">		*,?,[],&#123;&#125;</span><br><span class="line">例:</span><br><span class="line">字符          含义                     实例</span><br><span class="line">*       匹配 0 或多个字符               a*b a与b之间可以有任意长度的任意字符, 也可以一个也没有, 如aabcb, axyzb, a012b, ab。</span><br><span class="line">?       匹配任意一个字符                a?b a与b之间必须也只能有一个字符, 可以是任意字符, 如aab, abb, acb, a0b。</span><br><span class="line">[list]  匹配 list 中的任意单一字符       a[xyz]b a与b之间必须也只能有一个字符, 但只能是 x 或 y 或 z, 如: axb, ayb, azb。</span><br><span class="line">[!list] 匹配 除list 中的任意单一字符      a[!0-9]b a与b之间必须也只能有一个字符, 但不能是阿 拉伯数字, 如axb, aab, a-b。</span><br><span class="line">[c1-c2] 匹配 c1-c2 中的任意单一字符      如:[0-9] [a-z] a[0-9]b 0与9之间必须也只能有一个字符 如a0b, a1b... a9b。</span><br><span class="line">&#123;string1,string2,...&#125; 匹配 sring1 或 string2 (或更多)其一字符串 a&#123;abc,xyz,123&#125;b a与b之间只 能是abc或xyz或123这三个字符串之一。</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@newrain tmp]# rm -rf  /tmp/*</span><br><span class="line">[root@newrain tmp]# touch aabcb axyzb a012b ab acb </span><br><span class="line">[root@newrain tmp]# ls</span><br><span class="line">a012b aabcb ab axyzb acb</span><br><span class="line">[root@newrain tmp]# ls a*b</span><br><span class="line">a012b aabcb ab axyzb acb</span><br><span class="line">[root@newrain tmp]# ls a?b</span><br><span class="line">acb</span><br><span class="line">[root@newrain tmp]# rm -rf /tmp/* </span><br><span class="line">[root@newrain tmp]# touch axb ayb azb axyb </span><br><span class="line">[root@newrain tmp]# ls</span><br><span class="line">axb ayb azb</span><br><span class="line">[root@newrain tmp]# ls a[xy]b</span><br><span class="line">axb ayb</span><br><span class="line">[root@newrain tmp]# ls a[!xy]b</span><br><span class="line">azb</span><br><span class="line">[root@newrain tmp]# ls a[!x]b</span><br><span class="line">ayb  azb</span><br><span class="line">[root@newrain tmp]# rm -rf /tmp/* </span><br><span class="line">[root@newrain tmp]# touch a0b a1b a9b </span><br><span class="line">[root@newrain tmp]# ls a[0-9]b</span><br><span class="line">a0b a1b a9b</span><br><span class="line">[root@newrain tmp]# rm -rf /tmp/*</span><br><span class="line">[root@newrain tmp]# touch aabcb axyzb a012b ab </span><br><span class="line">[root@newrain tmp]# ls a&#123;abc&#125;b</span><br><span class="line">ls: cannot access a&#123;abc&#125;b: No such file or directory </span><br><span class="line">[root@newrain tmp]# ls a&#123;abc,xyz&#125;b</span><br><span class="line">aabcb axyzb</span><br><span class="line">[root@newrain tmp]# ls a&#123;abc,xyz,012&#125;b</span><br><span class="line">a012b aabcb axyzb</span><br></pre></td></tr></table></figure>

<h3 id="二、shell-脚本规范"><a href="#二、shell-脚本规范" class="headerlink" title="二、shell 脚本规范"></a>二、shell 脚本规范</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@newrain ~]# vim helloworld.sh   ---.sh代表这个文件是个shell脚本,第一个原因，让别人认的这个是shell脚本，sh后缀有高亮显示。</span><br><span class="line">拓展名后缀,如果省略.sh则不易判断该文件是否为shell脚本</span><br><span class="line">1. #!/usr/bin/env bash ---shebang蛇棒, 解释器, 翻译 2. #</span><br><span class="line">3. #</span><br><span class="line">3. # Author: newrain</span><br><span class="line">4. # Email: newrain@163.com           ---这就是注释, 你没看错</span><br><span class="line">5. # Github: https://github.com/newrain001</span><br><span class="line">6. # Date: 2019/**/**</span><br><span class="line">7. printf &quot;hello world\n&quot;</span><br><span class="line"></span><br><span class="line">功能说明:打印hello world</span><br><span class="line">[root@newrain ~]# sh helloworld.sh</span><br><span class="line">hello world</span><br><span class="line">[root@newrain ~]# chmod +x helloworld.sh </span><br><span class="line">[root@newrain ~]# ./helloworld.sh </span><br><span class="line">[root@newrain tmp]# /tmp/helloworld.sh </span><br><span class="line">hello world</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行脚本方式</span></span><br><span class="line">1、 sh 脚本.sh</span><br><span class="line">2、 bash 脚本.sh</span><br><span class="line">3、 ./脚本.sh  # 需要执行权限</span><br><span class="line">4、 .  脚本.sh</span><br><span class="line">5、 source 脚本.sh</span><br><span class="line">第一行: “#!/usr/bin/env bash”叫做shebang, shell语法规定shell脚本文件第一行为整个文件的解释器</span><br><span class="line">第二行: 为“#”开头的行为注释行默认不会被程序所读取, 用来说明文件及标定所属人员使用, 也可用来解释程序 第七行: 为格式化打印语句printf, printf可以把后面的“hello world”打印到指定的终端中, \n 为换行符</span><br></pre></td></tr></table></figure>

<h3 id="三、变量的类型"><a href="#三、变量的类型" class="headerlink" title="三、变量的类型"></a>三、变量的类型</h3><ul>
<li>变量 <ul>
<li>bash作为程序设计语言和其它高级语言一样也提供使用和定义变量的功能</li>
</ul>
</li>
<li>预定义变量、环境变量、自定义变量、位置变量</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">预定义变量</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">? 最后一次执行的命令的返回状态。如果这个变量的值为 0，则证明上一条命令正确执行;如果这个变量的值为非 0 ，则 证明上一条命令执行错误</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">$ 当前进程的进程号(PID)   <span class="built_in">echo</span> $$</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">! 后台运行的最后一个进程的进程号(PID)</span></span><br><span class="line"></span><br><span class="line">[root@newrain sh]# ls</span><br><span class="line">count.sh hello.sh parameter2.sh parameter.sh  #ls命令正确执行</span><br><span class="line">[root@newrain sh]# echo $?</span><br><span class="line">0</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">预定义变量<span class="string">&quot;$?&quot;</span>的值是0，证明上一条命令正确执</span></span><br><span class="line"></span><br><span class="line">[root@newrain sh]# vim variable.sh </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">echo &quot;The current process is $$&quot; </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">输出当前进程的PID</span> </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这个PID就是variable.sh脚本执行时生成的进程的PID</span></span><br><span class="line"></span><br><span class="line">[root@newrain sh]# sleep 3000 &amp; </span><br><span class="line">[1] 12165 </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">符号<span class="string">&quot;&amp;&quot;</span>的意思是把命令放入后台执行</span> </span><br><span class="line">[root@newrain sh]# echo $!</span><br><span class="line">12165</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">自定义变量</span><br><span class="line">		定义:变量名称=值</span><br><span class="line">				变量名称:只能由字母，数字，下划线组成，不能以数字开头；</span><br><span class="line">				注意:应该让变量名称有意义；</span><br><span class="line">				= 赋值符号 前后不能有空格 ；</span><br><span class="line">				值: 所有的字符串和数字都可以；</span><br><span class="line">				引用变量: $变量名 或 $&#123;变量名&#125;。</span><br><span class="line">		示例:</span><br><span class="line">    		[root@newrain ~]# a=100</span><br><span class="line">				[root@newrain ~]# echo $a</span><br><span class="line">				100</span><br><span class="line">				[root@newrain ~]# echo $aa</span><br><span class="line">                                # 这里输出为空，因为解释器认为$aa是变量</span><br><span class="line">				[root@newrain ~]# echo $&#123;a&#125;a</span><br><span class="line">				100a</span><br><span class="line"></span><br><span class="line">				查看变量: echo $变量名 set(所有变量:包括自定义变量和环境变量)</span><br><span class="line">				取消变量: unset 变量名 仅在当前shell中有效</span><br><span class="line">				作用范围: 仅在当前shell中生效</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">环境变量</span><br><span class="line">		shell在开始执行时已经定义好的 </span><br><span class="line">		env 查看所有环境变量</span><br><span class="line">		set 查看所有变量 </span><br><span class="line">				环境变量拥有可继承性:export之后就拥有继承性</span><br><span class="line">		export 导出变量(作用范围) </span><br><span class="line">临时生效</span><br><span class="line">    [root@newrain ~]# IPADDR=192.168.1.1</span><br><span class="line">		[root@newrain ~]# echo $IPADDR</span><br><span class="line">		192.168.1.1</span><br><span class="line">永久生效</span><br><span class="line">		写到4个登陆脚本中 ~/.bashrc ~/profile 更好放在/etc/profile.d/* 下建立独立的环境变量配置文件</span><br><span class="line">		常用环境变量:USER UID HOME HOSTNAME PWD PS1 PATH</span><br><span class="line">PATH:存储所有命令所在的路径</span><br></pre></td></tr></table></figure>

<h5 id="练习1"><a href="#练习1" class="headerlink" title="练习1"></a>练习1</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">编写一个shell脚本，用于搜集其执行主机的信息，打印结果如下: </span><br><span class="line">    [root@tiger tmp]# ./test.sh</span><br><span class="line">    2012年 05月 24日 星期四 17:07:45 CST</span><br><span class="line">    当前的用户为 root</span><br><span class="line">    当前用户的宿主目录为 /root 用户的标识为 0</span><br><span class="line">    主机名称为 newrain</span><br><span class="line">    网卡的IP地址为 192.168.1.106</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#脚本源码如下</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/bash</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取主机基本信息</span></span><br><span class="line">time=`date +%y年%m月%d日-%H:%M`</span><br><span class="line">ip=`ifconfig eth0|grep inet|awk &#x27;&#123;print $2&#125;&#x27;` </span><br><span class="line">echo &quot;现在的时间是:&quot; $time</span><br><span class="line">echo &quot;当前的用户是:&quot; $USER</span><br><span class="line">echo &quot;当前的用户标识:&quot; $UID</span><br><span class="line">echo &quot;当前的主机名称是:&quot; $HOSTNAME</span><br><span class="line">echo &quot;当前可用网卡IP是:&quot; $ip</span><br><span class="line">取根分区剩余空间:</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="built_in">df</span> -h /dev/sda2 |awk <span class="string">&#x27;NR==2&#123;print $4&#125;&#x27;</span> 371G</span></span><br><span class="line">取当前系统剩余内存:</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="built_in">echo</span> <span class="string">&quot;现在的剩余内存是:&quot;</span>`free -m |awk <span class="string">&#x27;NR==2&#123;print $4&#125;&#x27;</span>`</span></span><br><span class="line">		现在的剩余内存是:12813M</span><br><span class="line">取当前cpu平均负载:</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="built_in">echo</span> 现在cpu的`<span class="built_in">uptime</span> |<span class="built_in">cut</span> -d, -f3-` //-d指定分隔符，-f指定显示区域，3-第三列以后(包括第三列)</span></span><br><span class="line">		现在cpu的 load average: 0.07, 0.12, 0.11</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash"><span class="built_in">echo</span> 现在cpu的`<span class="built_in">uptime</span> |awk -F<span class="string">&quot;,&quot;</span> <span class="string">&#x27;&#123;print $4,$5,$6&#125;&#x27;</span>`</span></span><br><span class="line">		现在cpu的 load average: 0.00 0.04 0.10</span><br></pre></td></tr></table></figure>

<h5 id="练习2"><a href="#练习2" class="headerlink" title="练习2"></a>练习2</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">编写一个脚本实现显示时间和日期, 列出所有登录系统的用户,并且给出系统的当前时间以及已经运行多长时间.最后脚本还会 将这些信息写入一个日志文件.</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">centime=`date`</span><br><span class="line">nowtime=`uptime |awk &#x27;&#123;print $1&#125;&#x27;`</span><br><span class="line">username=`w -h |awk &#x27;&#123;print $1&#125;&#x27;|sort |uniq -c|awk &#x27;&#123;print $2&#125;&#x27;` </span><br><span class="line">time=`uptime |awk &#x27;&#123;print $3,$4,$5&#125;&#x27;`</span><br><span class="line">cat &gt;&gt;file1.txt &lt;&lt;EOF</span><br><span class="line">echo &quot;时间:$centime&quot;</span><br><span class="line">echo &quot;系统的当前时间是: $nowtime&quot;</span><br><span class="line">echo &quot;系统已运行的时长是: $time&quot;</span><br><span class="line">echo &quot;系统登录的用户有: $username&quot;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">预定义变量:</span><br><span class="line">    $$ 当前进程PID</span><br><span class="line">    $? 命令执行后的返回状态.0 为执行正确，非 0 为执行错误 </span><br><span class="line">    $# 位置参数的数量</span><br><span class="line">    $* 所有位置参数的内容</span><br><span class="line">    $@ 所有的参数</span><br><span class="line">    $! 上一个后台进程的PID (wait命令中使用,后面讲)</span><br><span class="line">拓展:$* 和 $@ 有什么区别</span><br><span class="line">练习. 设计一个shell脚本，要求其统计出占用cpu最高的进程,打印他的pid,在cpu使用率到80%结束进程</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">位置变量</span><br><span class="line">    $1 $2 $3 $... </span><br><span class="line">    #/test.sh start </span><br><span class="line">    #/test.sh 2 3 5 hello</span><br><span class="line">    start是第1个位置参数 </span><br><span class="line">        2 是第1个位置参数</span><br><span class="line">        3 是第2个 依次类推</span><br><span class="line">例子:</span><br><span class="line">[root@newrain shell]# cat weizhi.sh </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">...</span></span><br><span class="line">echo 我的第一个位置参数是:$1 </span><br><span class="line">echo 我的第二个位置参数是:$2 </span><br><span class="line">echo 我的第三个位置参数是:$3 </span><br><span class="line">echo 我的第四个位置参数是:$4 </span><br><span class="line">echo 一共有 $# 个位置参数 </span><br><span class="line">echo 你输入的参数分别是:$*</span><br><span class="line"></span><br><span class="line">求出第一个参数和第二个参数的和</span><br><span class="line">./5.sh 4 5</span><br><span class="line">9</span><br><span class="line">./5.sh 10 20 30</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">求 <span class="variable">$1</span> <span class="variable">$2</span> 的和</span> </span><br><span class="line">x=$&#123;1:-0&#125; </span><br><span class="line">y=$&#123;2:-0&#125;</span><br><span class="line">echo $(($x+$y))</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">变量运算</span><br><span class="line">算式运算符: +、-、*、/、()、%取余(取模)</span><br><span class="line">		(5+3)*2</span><br><span class="line">运算方式:$(()) $[] expr </span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">(())</span></span><br><span class="line">				# echo $(( 5+2-(3*2)/5 )) </span><br><span class="line">				6</span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">[]</span></span><br><span class="line">				# echo $[ 5 + 2 - (3*2)/5 ]</span><br><span class="line">				6 	</span><br><span class="line">		expr</span><br><span class="line">				# expr 5 + 3</span><br><span class="line">      	注意:运算符号两边的空格必须写</span><br><span class="line">				不能做浮点运算</span><br><span class="line">				# expr 5 + 3.0 expr: 非整数参数</span><br><span class="line">乘法运算:</span><br><span class="line">        [root@newrain shell]# expr 5 \* 8</span><br><span class="line">         40</span><br><span class="line">        [root@newrain shell]# expr 5 &#x27;*&#x27; 8</span><br><span class="line">         40</span><br><span class="line"></span><br><span class="line">			取1到6之间的随机数:</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">echo</span> $((<span class="variable">$RANDOM</span> % <span class="number">6</span> + <span class="number">1</span>))</span></span><br><span class="line">5</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">echo $(($RANDOM%50+1)) </span><br><span class="line">这串代码实现了随机生成从1~50之间是数</span><br><span class="line"></span><br><span class="line">这串代码特别简单，就是利用RANDOM这个随机数生成器进行取余就能够实现，至于为什么取余时需要+1是因为在取余时如果被 整除那么余数会是0，这样就不在限定范围内了</span><br><span class="line">如下实例是否正确? </span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">a=1;b=2</span></span><br><span class="line">    #c=$a*$b</span><br><span class="line">    #echo $c</span><br><span class="line">    </span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">c=$((<span class="variable">$a</span>*<span class="variable">$b</span>)) //正确写法</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">浮点运算</span><br><span class="line">bash本身不能做小数计算:需要bc命令转换 </span><br><span class="line">    #echo &quot;2*4&quot; | bc</span><br><span class="line">    #echo &quot;2^4&quot; | bc</span><br><span class="line">    #echo &quot;scale=2;6/4&quot; | bc</span><br><span class="line">    scale: 精度</span><br><span class="line"></span><br><span class="line">计算我的信用卡一年的利息，假设我欠10000块钱</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">m=$( echo 5/10000|bc -l)    #-l:定义使用的标准数学库 </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">m=`<span class="built_in">echo</span> 5/10000|bc -l`</span> </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">因为shell不支持小数，所以要用bc转换一下</span></span><br><span class="line">sum=10000</span><br><span class="line">for i in &#123;1..365&#125;</span><br><span class="line">do</span><br><span class="line">      sum=$(echo $sum+$sum*$m | bc )</span><br><span class="line">      echo $sum</span><br><span class="line">done</span><br><span class="line">echo $sum</span><br><span class="line">简单例子:</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash <span class="built_in">sum</span>=1</span></span><br><span class="line">for i in &#123;1..20&#125; </span><br><span class="line">do</span><br><span class="line">sum=$(echo $sum+1|bc)</span><br><span class="line">echo $sum</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">变量引用</span><br><span class="line">转义:\</span><br><span class="line">    当一个字符被引用时，其特殊含义被禁止 </span><br><span class="line">    把有意义的变的没意义，把没意义的变的有意义</span><br><span class="line">    \n \t</span><br><span class="line">    # echo -e &#x27;5\\n6\n7&#x27; </span><br><span class="line">    5\n6</span><br><span class="line">    7</span><br><span class="line">完全引用:&#x27;&#x27; //强引 硬引</span><br><span class="line">部分引用:&quot;&quot; //弱引 软引</span><br><span class="line"></span><br><span class="line">例子:</span><br><span class="line">[root@newrain shell]# num=1</span><br><span class="line">[root@newrain shell]# echo 1703班有$num个女生</span><br><span class="line">1703班有1个女生</span><br><span class="line">[root@newrain shell]# echo &quot;1703班有$num个女生&quot;</span><br><span class="line">1703班有1个女生</span><br><span class="line">[root@newrain shell]# echo &#x27;1703班有$num个女生&#x27;</span><br><span class="line">1703班有$num个女生</span><br><span class="line"></span><br><span class="line">读取用户标准输入:read </span><br><span class="line">read:功能就是读取键盘输入的值，并赋给变量 </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">read</span> -t 5 var</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">read</span> -p <span class="string">&quot;提示信息&quot;</span> var</span></span><br><span class="line">read后面的变量var可以只有一个，也可以有多个，这时如果输入多个数据，则第一个数据给第一个变量，第二个数据给第二 个变量，如果输入数据个数过多，则最后所有的值都给最后一个变量</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">read</span> -p <span class="string">&quot;后面的内容为提示信息，需要打印出来&quot;</span> -s <span class="string">&#x27;后面的内容是加密信息，不要输出&#x27;</span> -t 超时时间</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">read first second third</span><br><span class="line">echo &quot;the first parameter is $first&quot;</span><br><span class="line">echo &quot;the second parameter is $second&quot;</span><br><span class="line">echo &quot;the third parameter is $third&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">read</span> <span class="built_in">test</span></span></span><br><span class="line">read -p &quot;请输入你的银行卡帐号&quot; num </span><br><span class="line">read -p &quot;请在五秒内输入密码&quot; -t 5 pass </span><br><span class="line">echo &quot;你的密码错误!&quot;</span><br><span class="line">echo $num |mail -s &quot;card num&quot; root </span><br><span class="line">echo $pass|mail -s &quot;card pass&quot; root</span><br><span class="line">解析：</span><br><span class="line">将卡号和密码发送到本地邮箱</span><br><span class="line"></span><br><span class="line">云服务器发送失败解决:</span><br><span class="line">yum install -y postfix sendmail</span><br><span class="line">systemctl start postfix</span><br><span class="line">如果在这里起不来</span><br><span class="line">vim /etc/postfix/main.cf # 修改下列内容</span><br><span class="line">inet_interfaces = all</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">read -p &quot;Do you want to continue [Y/N]? &quot; answer </span><br><span class="line">case $answer in</span><br><span class="line">Y|y)</span><br><span class="line">    echo &quot;fine ,continue&quot;;;</span><br><span class="line">N|n)</span><br><span class="line">    echo &quot;ok,good bye&quot;;;</span><br><span class="line">*)</span><br><span class="line">    echo &quot;error choice&quot;;;</span><br><span class="line">esac</span><br><span class="line">exit 0</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">自定义程序结果的正确或错误</span></span><br><span class="line">-s 选项 能够使read命令中输入的数据不显示在监视器上</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">read -s -p &quot;Enter your password: &quot; pass </span><br><span class="line">echo &quot;your password is $pass&quot;</span><br><span class="line">exit 0</span><br><span class="line"></span><br><span class="line">取消屏幕回显</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">stty</span> -<span class="built_in">echo</span></span> </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">stty</span> <span class="built_in">echo</span></span></span><br><span class="line">变量长度</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">a=123</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">echo</span> <span class="variable">$&#123;#a&#125;</span></span></span><br><span class="line">3</span><br><span class="line">变量嵌套(扩展)</span><br><span class="line">表示(变量)$var的长度</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">eval</span> 执行字符串内的可执行命令</span></span><br><span class="line">[root@newrain ~]# name=&#x27;kobe&#x27; </span><br><span class="line">[root@newrain ~]# kobe=24 </span><br><span class="line">[root@newrain ~]# eval echo &#x27;$&#x27;&quot;$&#123;name&#125;&quot; </span><br><span class="line">24</span><br><span class="line">[root@newrain ~]# 先获取name的值，通过再次构造echo命令，使用eval再一次执行语句，就达到我们的目的。 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">[root@newrain shell]# cat d.sh</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">echo 1.配置yum客户端</span><br><span class="line">echo 2.添加A记录</span><br><span class="line">echo 3.一键安装lamp环境</span><br><span class="line">echo 4.一键配置静态IP</span><br><span class="line">read -p &quot;请选择你想使用的功能(1/2/3/4):&quot; num</span><br><span class="line">con_ip()&#123;</span><br><span class="line">echo 这是配置IP地址的小工具</span><br><span class="line">&#125;</span><br><span class="line">case $num in</span><br><span class="line">        1):</span><br><span class="line">        ;;</span><br><span class="line">        2):</span><br><span class="line">        ;;</span><br><span class="line">        3):</span><br><span class="line">        ;;</span><br><span class="line">				4)con_ip</span><br><span class="line">				;;</span><br><span class="line">				*):</span><br><span class="line">				;; </span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

<h3 id="四、脚本运行"><a href="#四、脚本运行" class="headerlink" title="四、脚本运行"></a>四、脚本运行</h3><h5 id="创建bash脚本（shell脚本）"><a href="#创建bash脚本（shell脚本）" class="headerlink" title="创建bash脚本（shell脚本）"></a>创建bash脚本（shell脚本）</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.创建脚本文件 </span><br><span class="line">		指定命令解释器</span><br><span class="line">		注释</span><br><span class="line">		编写bash指令集合 (脚本内容)</span><br><span class="line">2.修改权限</span><br></pre></td></tr></table></figure>

<h5 id="bash脚本执行"><a href="#bash脚本执行" class="headerlink" title="bash脚本执行"></a>bash脚本执行</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">./scripts</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">/shelldoc/scripts</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">. ./scripts 使用当前shell执行</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">source</span> ./scripts 使用当前shell执行 比如<span class="built_in">cd</span> /tmp会改变当前shell环境，但是其他的方式不会</span> </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">bash scripts</span></span><br></pre></td></tr></table></figure>

<h5 id="子shell"><a href="#子shell" class="headerlink" title="子shell"></a>子shell</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql ~]# vim bash.sh</span><br><span class="line">cd /opt/</span><br><span class="line">pwd</span><br><span class="line">[root@mysql ~]# sh bash.sh </span><br><span class="line">/opt</span><br><span class="line">[root@mysql ~]# source bash.sh </span><br><span class="line">/opt</span><br><span class="line">[root@mysql opt]#</span><br></pre></td></tr></table></figure>

<h5 id="bash-脚本测试"><a href="#bash-脚本测试" class="headerlink" title="bash 脚本测试"></a>bash 脚本测试</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">•sh –x script</span><br><span class="line">     这将执行该脚本并显示所有变量的值</span><br><span class="line">•sh –n script</span><br><span class="line">		 不执行脚本只是检查语法模式，将返回所有错误语法</span><br><span class="line">•sh –v script</span><br><span class="line">     执行脚本前把脚本内容显示在屏幕上</span><br></pre></td></tr></table></figure>

<h3 id="五、变量置换"><a href="#五、变量置换" class="headerlink" title="五、变量置换"></a>五、变量置换</h3><h5 id="命令替换"><a href="#命令替换" class="headerlink" title="命令替换"></a>命令替换</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a=`date +%m%d` </span><br><span class="line">a=$(date +%m%d) </span><br><span class="line">反引号亦可用$() 代替</span><br></pre></td></tr></table></figure>

<h5 id="变量替换"><a href="#变量替换" class="headerlink" title="变量替换"></a>变量替换</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">一 $&#123;parameter:-word&#125;</span><br><span class="line">若 parameter 为空或未设置，则用 word 代替 parameter 进行替换，parameter 的值不变 </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">a=1</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">unset</span> b</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">a=<span class="variable">$&#123;b:-3&#125;</span> <span class="comment"># echo $a</span></span></span><br><span class="line">3</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">echo</span> <span class="variable">$b</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">若 parameter 不为空，则不替换，parameter 的值不变 <span class="comment"># unset b</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># a=1</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">b=2</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">a=<span class="variable">$&#123;b:-3&#125;</span> <span class="comment"># echo $a</span></span></span><br><span class="line">2</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">echo</span> <span class="variable">$b</span></span></span><br><span class="line">2</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">二 <span class="variable">$&#123;parameter:=word&#125;</span></span></span><br><span class="line">若 parameter 为空或未设置，则用 word 代替 parameter 进行替换，parameter 的值改变 </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">a=1</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">unset</span> b</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">a=<span class="variable">$&#123;b:=3&#125;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">echo</span> <span class="variable">$a</span></span></span><br><span class="line">3</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">echo</span> <span class="variable">$b</span></span></span><br><span class="line">3</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">若 parameter设置了，则 不替换，parameter 的值不变</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">a=1</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">b=2</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">a=<span class="variable">$&#123;b:=3&#125;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">echo</span> <span class="variable">$a</span></span></span><br><span class="line">2</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">echo</span> <span class="variable">$b</span></span></span><br><span class="line">2</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">三 <span class="variable">$&#123;parameter:+word&#125;</span></span></span><br><span class="line">若 parameter 设置了，则用 word 代替 parameter 进行替换，parameter 的值不变 # a=1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">unset</span> b</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">a=<span class="variable">$&#123;b:+3&#125;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">echo</span> <span class="variable">$a</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">echo</span> <span class="variable">$b</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">a=1</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">b=2</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">a=<span class="variable">$&#123;b:+3&#125;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">echo</span> <span class="variable">$a</span></span></span><br><span class="line">3</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">echo</span> <span class="variable">$b</span></span> </span><br><span class="line">2</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">四 <span class="variable">$&#123;parameter:?message&#125;</span></span></span><br><span class="line">若 parameter 为空或未设置，则 message 作为标准错误打印出来，这可用来检查变量是否正确设置 # unset a</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="variable">$&#123;a:?unset a&#125;</span></span></span><br><span class="line">-bash: a: unset a</span><br></pre></td></tr></table></figure>

<h5 id="变量替换-匹配截取"><a href="#变量替换-匹配截取" class="headerlink" title="变量替换-匹配截取"></a>变量替换-匹配截取</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;变量#关键词&#125;  若变量内容从头开始的数据符合『关键词』，则将符合的最短数据切除</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;变量##关键词&#125; 若变量内容从头开始的数据符合『关键词』，则将符合的最长数据切除</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;变量%关键词&#125;  若变量内容从尾向前的数据符合『关键词』，则将符合的最短数据切除</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;变量%%关键词&#125; 若变量内容从尾向前的数据符合『关键词』，则将符合的最长数据切除</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;变量/旧字符串/新字符串&#125; 若变量内容符合『旧字符串』则『第一个旧字符串会被新字符串替代』</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;变量//旧字符串/新字符串&#125; 若变量内容符合『旧字符串』则『全部的旧字符串会被新字符串替代』</span></span><br><span class="line"></span><br><span class="line">索引及切片            </span><br><span class="line">[root@newrain ~]# a=12345678</span><br><span class="line">[root@newrain ~]# echo $&#123;a:5&#125; //从第5位开始截取 </span><br><span class="line">678</span><br><span class="line">[root@newrain ~]# echo $&#123;a:3:4&#125;</span><br><span class="line">4567</span><br><span class="line">[root@newrain ~]# echo $&#123;a:2:-1&#125;</span><br><span class="line">34567</span><br><span class="line">[root@newrain ~]# echo $&#123;a:2:-2&#125;</span><br><span class="line">3456</span><br><span class="line">[root@newrain ~]# url=www.sina.com.cn </span><br><span class="line">[root@newrain ~]# echo $&#123;#url&#125; //获取变量的长度 </span><br><span class="line">15</span><br><span class="line">[root@newrain ~]# echo $&#123;url&#125; //正常显示变量 </span><br><span class="line">www.sina.com.cn</span><br><span class="line">变量内容的删除</span><br><span class="line">[root@newrain ~]# echo $&#123;url#*.&#125;   从前往后，最短匹配</span><br><span class="line">sina.com.cn</span><br><span class="line">[root@newrain ~]# echo $&#123;url##*.&#125;  从前往后，最长匹配</span><br><span class="line">cn</span><br><span class="line">[root@newrain ~]# echo $&#123;url%.*&#125;   从后往前，最短匹配</span><br><span class="line">www.sina.com</span><br><span class="line">[root@newrain ~]# echo $&#123;url%%.*&#125;  从后往前，最长匹配</span><br><span class="line">www</span><br><span class="line">[root@newrain ~]# echo $&#123;url#a.&#125; </span><br><span class="line">www.sina.com.cn</span><br><span class="line">[root@newrain ~]# echo $&#123;url#*a.&#125; </span><br><span class="line">com.cn</span><br><span class="line"></span><br><span class="line">变量内容的替换</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">a=123456123789</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">echo</span> <span class="variable">$&#123;a/1/&#125;</span>                  第一次匹配的被替换</span></span><br><span class="line">23456123789</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">echo</span> <span class="variable">$&#123;a//1/&#125;</span>                 全局的匹配被替换</span></span><br><span class="line">2345623789</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">echo</span> <span class="variable">$&#123;a/1/x&#125;</span></span></span><br><span class="line">x23456123789</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">echo</span> <span class="variable">$&#123;a//1/x&#125;</span></span></span><br><span class="line">x23456x23789</span><br><span class="line"></span><br><span class="line">例:  file=/dir1/dir2/dir3/my.file.txt</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;file#*/&#125;:  拿掉第一条 / 及其左边的字符串:dir1/dir2/dir3/my.file.txt <span class="variable">$&#123;file##*/&#125;</span>: 拿掉最后一条 / 及其左边的字符串:my.file.txt</span> </span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;file#*.&#125;:  拿掉第一个 . 及其左边的字符串:file.txt</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;file##*.&#125;: 拿掉最后一个 . 及其左边的字符串:txt</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;file%/*&#125;:  拿掉最后条 / 及其右边的字符串:/dir1/dir2/dir3 <span class="variable">$&#123;file%%/*&#125;</span>: 拿掉第一条 / 及其右边的字符串:(空值)</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;file%.*&#125;:  拿掉最后一个 . 及其右边的字符串:/dir1/dir2/dir3/my.file <span class="variable">$&#123;file%%.*&#125;</span>: 拿掉第一个 . 及其右边的字符串:/dir1/dir2/dir3/my</span></span><br><span class="line">记忆的方法为:</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">是去掉左边(在键盘上 <span class="comment"># 在 $ 之左边)</span></span></span><br><span class="line"><span class="meta prompt_">% </span><span class="language-bash">是去掉右边(在键盘上 % 在 $ 之右边)</span> </span><br><span class="line">单一符号是最小匹配;两个符号是最大匹配(贪婪匹配)。</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">a=123</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">echo</span> <span class="variable">$&#123;#a&#125;</span> 表示<span class="variable">$var</span>的长度</span> </span><br><span class="line">3</span><br></pre></td></tr></table></figure>

<h5 id="basename-dirname"><a href="#basename-dirname" class="headerlink" title="basename &amp; dirname"></a>basename &amp; dirname</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">basename 命令</span><br><span class="line">basename 是去除目录后剩下的名字 </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">不会检测文件系统，只是取路径的最后一段，将他截取出来</span></span><br><span class="line">例: </span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">temp=/home/temp/1.<span class="built_in">test</span></span></span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">base=`<span class="built_in">basename</span> <span class="variable">$temp</span>`</span></span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash"><span class="built_in">echo</span> <span class="variable">$base</span></span> </span><br><span class="line">结果为:1.test</span><br><span class="line">dirname 是去除文件的目录名</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">不会检测文件系统，默认路径的最后一段为文件名，把它扇区</span></span><br><span class="line">例:</span><br><span class="line">    #temp=/home/temp/1.test</span><br><span class="line">    #dir=`dirname $temp`</span><br><span class="line">    #echo $dir </span><br><span class="line">结果为:/home/temp</span><br><span class="line"></span><br><span class="line">dirname 获取当前脚本的路径</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">( <span class="built_in">cd</span> $( <span class="built_in">dirname</span> <span class="variable">$0</span> ) ; <span class="built_in">pwd</span> )</span></span><br></pre></td></tr></table></figure>

<h3 id="六、shell编程-流程控制"><a href="#六、shell编程-流程控制" class="headerlink" title="六、shell编程-流程控制"></a>六、shell编程-流程控制</h3><h5 id="shell编程-条件结构"><a href="#shell编程-条件结构" class="headerlink" title="shell编程-条件结构"></a>shell编程-条件结构</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">测试</span><br><span class="line">test 条件</span><br><span class="line">条件为真返回 0，条件为假返回 1</span><br><span class="line">[ 条件 ]</span><br><span class="line">test 能够理解3种类型的表达式 </span><br><span class="line">1.文件测试</span><br><span class="line">2.字符串比较</span><br><span class="line">3.数字比较</span><br><span class="line">字符串</span><br><span class="line">    -n STRING</span><br><span class="line">    # -n 字符串长度不为零</span><br><span class="line">    -z STRING</span><br><span class="line">    # -z  字符串长度为0</span><br><span class="line">     STRING1 = STRING2</span><br><span class="line">    # = 判断两个字符串是否一样</span><br><span class="line">     STRING1 != STRING2</span><br><span class="line">    # ！= 判断两个字符串是否不一样</span><br><span class="line">数字</span><br><span class="line">    eq 等于       ne 不等于  #</span><br><span class="line">    ge 大于等于    le 小于等于   #</span><br><span class="line">    gt 大于       lt 小于   #</span><br><span class="line">文件</span><br><span class="line">test</span><br><span class="line">    -f 存在且是普通文件  # 重要</span><br><span class="line">    -d 存在且是目录  #</span><br><span class="line">    -h 存在且是符号链接 </span><br><span class="line">    -b 块设备</span><br><span class="line">    -c 字符设备</span><br><span class="line">    -e 文件存在  #</span><br></pre></td></tr></table></figure>

<h5 id="shell分支if语句"><a href="#shell分支if语句" class="headerlink" title="shell分支if语句"></a>shell分支if语句</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">流控制:</span><br><span class="line">•在一个shell脚本中的命令执行顺序称作脚本的流。大多数脚本会根据一个或多个条件来改变它们的流。 </span><br><span class="line">•流控制命令:能让脚本的流根据条件而改变的命令称为条件流控制命令 </span><br><span class="line">•exit语句:退出程序的执行，并返回一个返回码，返回码为0正常退出，非0为非正常退出，例如: </span><br><span class="line">•exit 0</span><br><span class="line"></span><br><span class="line">条件判断</span><br><span class="line">If代码返回0表示真，非0为假</span><br><span class="line">if语句语法如下:   1</span><br><span class="line">if [ $1 -eq 1 ]</span><br><span class="line">then</span><br><span class="line">      echo &#x27;等于1&#x27;</span><br><span class="line">elif [ $1 -eq 2 ]</span><br><span class="line">then</span><br><span class="line">			echo &#x27;等于二&#x27;</span><br><span class="line">else</span><br><span class="line">			echo &#x27;既不等一，也不等于二&#x27;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">例:</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">read -p &quot;请输入号码: &quot; num </span><br><span class="line">if [ $num = 1 ];then</span><br><span class="line">        echo &quot;1&quot;</span><br><span class="line">elif [ $num = 2 ];then</span><br><span class="line">				echo &quot;2&quot;</span><br><span class="line">else </span><br><span class="line">				echo &quot;输入有误!&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">例:脚本if.sh，必须在脚本后加上适当的参数脚本才能正确执行 </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">if [ &quot;$1&quot; = &quot;hello&quot; ]; then</span><br><span class="line">        echo &quot;Hello! How are you ?&quot;</span><br><span class="line">elif [ &quot;$1&quot; = &quot;&quot; ]; then</span><br><span class="line">				echo &quot;You MUST input parameters&quot;</span><br><span class="line">else</span><br><span class="line">				echo &quot;The only accept parameter is hello&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">练习(选做):</span><br><span class="line">1)检测apache是否运行，如果没有运行则启动，并记录启动的时间，保存到日志中。 </span><br><span class="line">2)测试ip地址主机位从2到100的机器是否存活，并把存活的机器记录到文本文件alivehost.txt内。(使用ping命令)</span><br><span class="line"></span><br><span class="line">多个条件联合</span><br><span class="line">逻辑与</span><br><span class="line">if [ $condition1 ] &amp;&amp; [ $condition2 ] </span><br><span class="line">if [ $condition -a $condition2 ]</span><br><span class="line">if [[ $condition1 &amp;&amp; $condition2 ]]</span><br><span class="line">逻辑或</span><br><span class="line">if [ $condition1 ] || [ $condition2 ] </span><br><span class="line">if [ $condition -o $condition2 ]</span><br><span class="line">if [[ $condition1 || $condition2 ]]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">test</span> 和 [] 中 我们可以使用 [ <span class="variable">$condition1</span> ] &amp;&amp; [ <span class="variable">$condition2</span> ] 或者 [ <span class="variable">$condition</span> -a <span class="variable">$condition2</span> ]</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在 [[]] 这种情况，我们可以直接使用[[ <span class="variable">$condition1</span> &amp;&amp; <span class="variable">$condition2</span> ]]</span></span><br><span class="line">建议在if中直接使用[[]]这种方式，这种方式更加稳定。[[]] shell的一个命令。</span><br><span class="line">-a &amp;&amp;  逻辑与 and 两端的条件都可以成立</span><br><span class="line">-o ||  逻辑或 or  两端的条件有一段成立就行</span><br><span class="line"></span><br><span class="line">练习:</span><br><span class="line">编写脚本port.sh，执行脚本后显示系统的httpd、ftp、ssh、sendmail这些服务是否开启</span><br><span class="line"></span><br><span class="line">case</span><br><span class="line">case 语句是 shell 中流控制的第二种方式,语法如下: </span><br><span class="line">case $word in</span><br><span class="line">     pattern1)</span><br><span class="line">						list1</span><br><span class="line">						;; </span><br><span class="line">     pattern2)</span><br><span class="line">						list2</span><br><span class="line">						;; </span><br><span class="line">     patternN)</span><br><span class="line">          	listN</span><br><span class="line">          	;;</span><br><span class="line">		 *)</span><br><span class="line">						list*</span><br><span class="line">						;; </span><br><span class="line">esac</span><br><span class="line">命令;;表明流应该跳转到case语句的最后，类似C语言中的break指令。</span><br><span class="line">练习:建立脚本case.sh，当执行时，要求我们在键盘输入适当的值(one|two|three)，当输入正确时并打印，当输入错误 时会提示你，应该输入正确的值。</span><br></pre></td></tr></table></figure>

<h5 id="作业1"><a href="#作业1" class="headerlink" title="作业1"></a>作业1</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">作业</span><br><span class="line">1. ping主机测试</span><br><span class="line">2. 判断一个用户是否存在</span><br><span class="line">3. 判断当前内核主版本是否为3，且次版本是否大于10</span><br><span class="line">4. 判断vsftpd软件包是否安装，如果没有则自动安装 (yum是否能用，不能用自动修复，安装完成测试以下，是否能用。)</span><br><span class="line">5. 判断httpd是否运行</span><br><span class="line">6. 判断指定的主机是否能ping通，必须使用$1变量</span><br><span class="line">7. 报警脚本，要求如下:</span><br><span class="line">    根分区剩余空间小于20%</span><br><span class="line">    内存已用空间大于80%</span><br><span class="line">    向用户alice发送告警邮件</span><br><span class="line">    配合crond每5分钟检查一次</span><br><span class="line">    echo &quot;邮件正文&quot; | mail -s &quot;邮件主题&quot; alice 可以报警</span><br><span class="line">8. 判断用户输入的是否是数字 </span><br><span class="line">read -p &quot;请输入:&quot; get</span><br><span class="line">case $get in </span><br><span class="line">[0-9][0-9]*)     #判断输入是否是数字</span><br><span class="line">		echo -e &quot;你输入是数字。\n&quot;</span><br><span class="line">;; </span><br><span class="line">*)</span><br><span class="line">		echo -e &quot;你输入的不是数字。\n&quot;</span><br><span class="line">;; </span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

<h5 id="shell-分支case语句"><a href="#shell-分支case语句" class="headerlink" title="shell 分支case语句"></a>shell 分支case语句</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">case $var in</span><br><span class="line">模式1)</span><br><span class="line">				执行1</span><br><span class="line">				;;</span><br><span class="line">模式2)</span><br><span class="line">				执行2</span><br><span class="line">				;;</span><br><span class="line">模式3)</span><br><span class="line">				执行3</span><br><span class="line">				;;</span><br><span class="line">*)</span><br><span class="line">				执行4</span><br><span class="line">esac</span><br><span class="line"></span><br><span class="line">第一行: 声明case关键字调用case语法, 紧跟的“变量”一般为用户的输入值, in代表从下方的各个模式进行匹配 </span><br><span class="line">第2-4行: 匹配到“模式1”后进行命令的输出或执行, 模式1: 一般为字符或数值</span><br><span class="line">第11-12行: 当用户输入的字符不存在匹配模式时, 直接执行或打印*)下的命令或语句</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@bavdu shell_scripts]# vim system_tools</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/env bash</span></span><br><span class="line">cat &lt;&lt;-EOF </span><br><span class="line">+-------------------------------------------------------------------------+ </span><br><span class="line">|                             System_tools V1.0                           | </span><br><span class="line">+-------------------------------------------------------------------------+</span><br><span class="line">|                     a. Stop And Disabled Firewalld.                     |</span><br><span class="line">|                     b. Disabled SELinux Secure System.                  |</span><br><span class="line">|                     c. Install Apache Service.                          |</span><br><span class="line">|                     d. Quit                                             | </span><br><span class="line">+-------------------------------------------------------------------------+ </span><br><span class="line">EOF</span><br><span class="line">echo &quot;Please input your select: &quot; &amp;&amp; read var</span><br><span class="line">case &quot;$var&quot; in</span><br><span class="line">  	&quot;a&quot;)</span><br><span class="line">        systemctl stop firewalld &amp;&amp; systemctl disable firewalld</span><br><span class="line">				;; </span><br><span class="line">		&quot;b&quot;)</span><br><span class="line">				setenforce 0</span><br><span class="line">				;; </span><br><span class="line">		&quot;c&quot;)</span><br><span class="line">				yum -y install httpd httpd-tools</span><br><span class="line">				;; </span><br><span class="line">		&quot;d&quot;)</span><br><span class="line">				exit</span><br><span class="line">				;; </span><br><span class="line">			*)</span><br><span class="line">				printf &quot;请按照上方提供的选项输入!!!\n&quot;</span><br><span class="line">				;; </span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

<h3 id="七、shell编程-循环结构"><a href="#七、shell编程-循环结构" class="headerlink" title="七、shell编程-循环结构"></a>七、shell编程-循环结构</h3><h5 id="shell循环-for语句"><a href="#shell循环-for语句" class="headerlink" title="shell循环-for语句"></a>shell循环-for语句</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for i in &#123;取值范围&#125;    # for 关键字  i 变量名 in 关键字  取值范围格式 1 2 3 4 5</span><br><span class="line">do                    # do 循环体的开始</span><br><span class="line">				循环体</span><br><span class="line">done                  # done 循环体的结束	</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/env bash</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Author:</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Date: 2019/**/**</span></span><br><span class="line">for i in &#123;1..100&#125; </span><br><span class="line">do</span><br><span class="line">				echo $i </span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash         <span class="comment"># 类似c语言的循环方式</span></span></span><br><span class="line">for (( i=1;i &lt;= 5;i++ ))</span><br><span class="line">do</span><br><span class="line">				echo &quot;$i&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>测试生产环境的主机存活性</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/env bash <span class="comment">#</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Author:       <span class="comment">#&#123;&#125;&amp;  并发</span></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">ip_alive.txt     <span class="comment"># 在执行脚本之前，先将文件清空</span></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">ip_down.txt</span></span><br><span class="line">segment=&quot;192.168.161&quot; </span><br><span class="line">for i in &#123;2..254&#125;</span><br><span class="line">do</span><br><span class="line">        &#123;</span><br><span class="line">        ping -c1 $segment.$i &amp;&gt;/dev/null </span><br><span class="line">        if [ $? -eq 0 ];then</span><br><span class="line">        				printf &quot;alive: $segment.$i\n&quot; &gt;&gt;ip_alive.txt</span><br><span class="line">        else</span><br><span class="line">        				printf &quot;down: $segment.$i\n&quot; &gt;&gt;ip_down.txt</span><br><span class="line">        fi</span><br><span class="line">        &#125;&amp; </span><br><span class="line">done</span><br><span class="line">wait    #等待循环结束后，执行下面操作</span><br><span class="line">echo &quot;finish...&quot;</span><br></pre></td></tr></table></figure>

<p>for循环批量创建用户</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span> </span><br><span class="line">while :     #死循环</span><br><span class="line">do</span><br><span class="line">read -p &quot;请设置用户前缀/数量/密码: &quot; prefix num pass </span><br><span class="line">cat &lt;&lt;-EOF                 # 打印到屏幕</span><br><span class="line">用户前缀:$prefix</span><br><span class="line">用户数量:$num</span><br><span class="line">用户密码:$pass</span><br><span class="line">EOF</span><br><span class="line">read -p &quot;是否确认创建:[Y/N]&quot; action </span><br><span class="line">if [ $action = Y ];then</span><br><span class="line">	 &quot;starting create users...&quot; </span><br><span class="line">	 break</span><br><span class="line">fi</span><br><span class="line">done</span><br><span class="line">for i in `seq -w $num`</span><br><span class="line">do</span><br><span class="line">    user=$prefix$i</span><br><span class="line">    id $user &amp;&gt;/dev/null </span><br><span class="line">    if [ $? -eq 0 ];then</span><br><span class="line">          echo &quot;$user  is already exist&quot;</span><br><span class="line">    else</span><br><span class="line">          useradd $user</span><br><span class="line">          echo $pass | passwd --stdin $user &amp;&gt;/dev/null  # 用户密码设置不需要交互</span><br><span class="line">    fi </span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h5 id="shell-循环while语句"><a href="#shell-循环while语句" class="headerlink" title="shell 循环while语句"></a>shell 循环while语句</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">while 条件    # while 关键字  条件  [ $1 -lt 10 ] ,while循环，条件为真的情况下，会循环</span><br><span class="line">do</span><br><span class="line">		循环体</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>完善系统工具的输出及操作性</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">创建一个文件里面的用户</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">while read user</span><br><span class="line">do</span><br><span class="line">		id $user &amp;&gt;/dev/null </span><br><span class="line">		if [ $? -eq 0 ];then</span><br><span class="line">				echo &quot;$user is already exists&quot;</span><br><span class="line">		else</span><br><span class="line">				useradd $user</span><br><span class="line">				echo &quot;create $user successfully&quot;</span><br><span class="line">		fi</span><br><span class="line">done &lt; user.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/env bash</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Author:</span></span></span><br><span class="line">while 1&gt;0 </span><br><span class="line">do</span><br><span class="line">cat &lt;&lt;-EOF </span><br><span class="line">+-------------------------------------------------------------------------+ </span><br><span class="line">|                            System_tools V1.0                            | </span><br><span class="line">+-------------------------------------------------------------------------+</span><br><span class="line">|                      a. Stop And Disabled Firewalld.                    |</span><br><span class="line">|                      b. Disabled SELinux Secure System.                 |</span><br><span class="line">|                      c. Install Apache Service.                         |</span><br><span class="line">|                      d. Quit                                            | </span><br><span class="line">+-------------------------------------------------------------------------+</span><br><span class="line">EOF</span><br><span class="line">    echo &quot; Please input your select: &quot; &amp;&amp; read var</span><br><span class="line">    case &quot;$var&quot; in</span><br><span class="line">				&quot;a&quot;)</span><br><span class="line">        			systemctl stop firewalld &amp;&amp; systemctl disable firewalld</span><br><span class="line">							;; </span><br><span class="line">				&quot;b&quot;)</span><br><span class="line">							sed -ri s/SELINUX=enforcing/SELINUX=disabled/g /etc/selinux/config</span><br><span class="line">							;; </span><br><span class="line">				&quot;c&quot;)</span><br><span class="line">							yum -y install httpd httpd-tools</span><br><span class="line">							;; </span><br><span class="line">				&quot;d&quot;)</span><br><span class="line">							exit</span><br><span class="line">							;; </span><br><span class="line">				  *)</span><br><span class="line">							echo &quot;请按照上方提供的选项输入!!!&quot;</span><br><span class="line">							;; </span><br><span class="line">		esac</span><br><span class="line">    if [ $? -eq 0 ];then </span><br><span class="line">    		clear</span><br><span class="line">    else</span><br><span class="line">        echo &quot;Warning: Your program exist ERROR!!!&quot;</span><br><span class="line">        break</span><br><span class="line">    fi </span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">练习题:</span><br><span class="line">输出用户输入的参数，直到用户输入 &quot;end&quot; 结束循环</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/bash</span></span><br><span class="line">while 2&gt;1</span><br><span class="line">do</span><br><span class="line">	read -p &quot;请输入： &quot; word</span><br><span class="line">	if [ $word != &#x27;end&#x27; ];then</span><br><span class="line">		echo &quot;$word&quot;</span><br><span class="line">	else</span><br><span class="line">		echo &quot;退出循环&quot;</span><br><span class="line">		break</span><br><span class="line">	fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h5 id="shell循环until语句"><a href="#shell循环until语句" class="headerlink" title="shell循环until语句"></a>shell循环until语句</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">until 条件 # 当后面的条件表达式，为假的时候进行循环，当他为真了就停止循环了。</span><br><span class="line">do</span><br><span class="line">循环体</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@newrain ~]# cat until.sh </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">x=1</span><br><span class="line">until [ $x -ge 10 ]</span><br><span class="line">do</span><br><span class="line">		echo $x</span><br><span class="line">		x=`expr $x + 1` </span><br><span class="line">done</span><br><span class="line">x=1</span><br><span class="line"></span><br><span class="line">while [ ! $x -ge 10 ]</span><br><span class="line">do</span><br><span class="line">		echo $x</span><br><span class="line">		x=`expr $x + 1`</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h5 id="shell-循环控制shift、continue、break、exit"><a href="#shell-循环控制shift、continue、break、exit" class="headerlink" title="shell 循环控制shift、continue、break、exit"></a>shell 循环控制shift、continue、break、exit</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">shift命令</span><br><span class="line">位置参数可以用shift命令左移。比如shift 3表示原来的$4现在变成$1，原来的$5现在变成$2等等，原来的$1、$2、$3丢 弃，$0不移动。不带参数的shift命令相当于shift 1。</span><br><span class="line">对于位置变量或命令行参数，其个数必须是确定的，或者当 Shell 程序不知道其个数时，可以把所有参数一起赋值给变量 $*。</span><br><span class="line">若用户要求 Shell 在不知道位置变量个数的情况下，还能逐个的把参数一一处理，也就是在 $1 后为 $2,在 $2 后面为 $3 等,则需要用shift把所有参数变成$1</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">测试 <span class="built_in">shift</span> 命令(x_shift3.sh)</span></span><br><span class="line">[root@newrain shell]# cat x_shift3.sh </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">shift</span><br><span class="line">echo &quot;第一个位置参数: $1&quot;</span><br><span class="line">[root@newrain shell]# bash x_shift3.sh 2 3</span><br><span class="line">第一个位置参数: 3</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">测试 <span class="built_in">shift</span> 命令(x_shift.sh)</span> </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">until [ $# -eq 0 ]</span><br><span class="line">do</span><br><span class="line">echo &quot;第一个参数为: $1 参数个数为: $#&quot; </span><br><span class="line">shift</span><br><span class="line">done</span><br><span class="line">执行以上程序x_shift.sh: </span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">./x_shift.sh 1 2 3 4</span></span><br><span class="line">结果显示如下:</span><br><span class="line">第一个参数为: 1 参数个数为: 4 </span><br><span class="line">第一个参数为: 2 参数个数为: 3 </span><br><span class="line">第一个参数为: 3 参数个数为: 2 </span><br><span class="line">第一个参数为: 4 参数个数为: 1</span><br><span class="line"></span><br><span class="line">从上可知 shift 命令每执行一次，变量的个数($#)减一，而变量值提前一位</span><br><span class="line"></span><br><span class="line">用 until 和 shift 命令计算所有命令行参数的和。 </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">shift</span> 上档命令的应用(x_shift2.sh)</span></span><br><span class="line">sum=0</span><br><span class="line"></span><br><span class="line">until [ $# -eq 0 ] </span><br><span class="line">do</span><br><span class="line">		sum=`expr $sum + $1`</span><br><span class="line">		shift </span><br><span class="line">done</span><br><span class="line">echo &quot;sum is: $sum&quot;</span><br><span class="line">执行上述程序: </span><br><span class="line"><span class="meta prompt_">		$</span><span class="language-bash">x_shift2.sh 10 20 15</span></span><br><span class="line">其显示结果为:</span><br><span class="line">		45</span><br><span class="line"></span><br><span class="line">continue、break、exit命令</span><br><span class="line">Linux脚本中的break continue exit return </span><br><span class="line"></span><br><span class="line">break</span><br><span class="line">结束并退出本次循环</span><br><span class="line"></span><br><span class="line">continue </span><br><span class="line">在循环中不执行continue下面的代码，转而进入下一轮循环</span><br><span class="line"></span><br><span class="line">exit</span><br><span class="line">退出脚本</span><br><span class="line">常带一个整数给系统，如 exit 0</span><br><span class="line"></span><br><span class="line">可理解为:break是立马跳出循环;continue是跳出当前条件循环，继续下一轮条件循环;exit是直接退出整个脚本 </span><br><span class="line">例如: </span><br><span class="line">在循环过程中，有时候需要在未达到循环结束条件时强制跳出循环，Shell使用两个命令来实现该功能:break和continue。 </span><br><span class="line">break命令</span><br><span class="line">break命令允许跳出所有循环(终止执行后面的所有循环)。</span><br><span class="line">下面的例子中，脚本进入死循环直至用户输入数字大于5。要跳出这个循环，返回到shell提示符下，需要使用break命令。 </span><br><span class="line">代码如下:</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">while :</span><br><span class="line">do</span><br><span class="line">		echo -n &quot;请输入1-5之间的数字 &quot; </span><br><span class="line">		read aNum</span><br><span class="line">		case $aNum in</span><br><span class="line">        1|2|3|4|5) </span><br><span class="line">        		echo &quot;您的数字是 $aNum!&quot;</span><br><span class="line">        ;;</span><br><span class="line">        *) echo &quot;您输入的数字不再1-5中间，游戏结束!&quot;</span><br><span class="line">						break </span><br><span class="line">				;;</span><br><span class="line">		esac </span><br><span class="line">done</span><br><span class="line">continue命令</span><br><span class="line">continue命令与break命令类似，只有一点差别，它不会跳出所有循环，仅仅跳出当前循环。 </span><br><span class="line">对上面的例子进行修改:</span><br><span class="line">代码如下:</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">while :</span><br><span class="line">do</span><br><span class="line">		echo -n &quot;请输入1-5之间的数字  &quot; </span><br><span class="line">		read aNum</span><br><span class="line">		case $aNum in</span><br><span class="line">        1|2|3|4|5) </span><br><span class="line">        		echo &quot;您的数字是 $aNum!&quot;</span><br><span class="line">        ;;</span><br><span class="line">        *) </span><br><span class="line">        		echo &quot;您输入的数字不再1-5中间，游戏结束!&quot;;、</span><br><span class="line">						continue </span><br><span class="line">				;;</span><br><span class="line">		esac </span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">运行代码发现，当输入大于5的数字时，该例中的循环不会结束.</span><br><span class="line">break和exit的区别</span><br><span class="line">[root@newrain shell]# cat case07.sh </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">while true</span><br><span class="line">do</span><br><span class="line">read -p &quot;请输入[1/2]&quot; num1</span><br><span class="line">case $num1 in</span><br><span class="line">1) </span><br><span class="line">		echo $num1</span><br><span class="line">;;</span><br><span class="line">2)</span><br><span class="line">		while true </span><br><span class="line">		do</span><br><span class="line">				read -p &quot;再次输入[1/2]:&quot; num2 </span><br><span class="line">						case $num2 in</span><br><span class="line">								1) echo $num2;;</span><br><span class="line"> 								2) break;             #将此处换成exit，再次尝试</span><br><span class="line">						esac</span><br><span class="line"> 		done</span><br><span class="line">esac</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h5 id="实战-shell版本jumpserver开发-堡垒机"><a href="#实战-shell版本jumpserver开发-堡垒机" class="headerlink" title="实战-shell版本jumpserver开发(堡垒机)"></a>实战-shell版本jumpserver开发(堡垒机)</h5><p>ps：整理自己的思路，完善不足的地方</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/env bash</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Author:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">可以先添加上账密验证环节</span></span><br><span class="line">while :        # 死循环</span><br><span class="line">do</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash"><span class="built_in">trap</span> <span class="string">&#x27;:&#x27;</span> INT EXIT TSTP TERM HUP  <span class="comment"># 拒绝 ctrl+c ctrl+d 其他的退出方式</span></span></span><br><span class="line">	clear</span><br><span class="line">cat &lt;&lt;-EOF </span><br><span class="line">+-------------------------------------+</span><br><span class="line">|        JumpServer @Version1.0       | </span><br><span class="line">+-------------------------------------+</span><br><span class="line">| a. WebServer Apache.                |</span><br><span class="line">| b. MySQL Databases Server.          |</span><br><span class="line">| c. PHP Development Computer.        |</span><br><span class="line">| d. Quit                             |</span><br><span class="line">+-------------------------------------+</span><br><span class="line">EOF</span><br><span class="line">    read -p &quot;请输入你要登录的服务器编号: &quot;  computer</span><br><span class="line">    case $computer in</span><br><span class="line">    a)</span><br><span class="line">    		ssh jumper@192.168.161.129                     # 可以嵌套子case循环</span><br><span class="line">    		;; </span><br><span class="line">    b)</span><br><span class="line">    		ssh jumper@192.168.161.130</span><br><span class="line">    		;; </span><br><span class="line">    c)</span><br><span class="line">    		ssh jumper@192.168.161.131</span><br><span class="line">    		;; </span><br><span class="line">    d)</span><br><span class="line">    		exit</span><br><span class="line">    		;; </span><br><span class="line">    *)</span><br><span class="line">        printf &quot;ERROR: Please redo your select!&quot;</span><br><span class="line">    		;; </span><br><span class="line">    esac</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h3 id="八、shell-编程-函数"><a href="#八、shell-编程-函数" class="headerlink" title="八、shell 编程-函数"></a>八、shell 编程-函数</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function (功能) 功能函数</span><br><span class="line"></span><br><span class="line">完成特定功能的代码片段</span><br><span class="line">函数必须先定义才能使用</span><br><span class="line">优点:避免重复的代码</span><br><span class="line"></span><br><span class="line">定义函数  1 怎么定义 2 定义什么东西</span><br><span class="line">调用函数  1 可以本地调用，也可以调用别的脚本的函数 2 在不调用之前，它相当于没有</span><br><span class="line">取消函数  1 把函数名想象成一个变量名</span><br><span class="line">函数传参  1 跟脚本传参很类似</span><br><span class="line"></span><br><span class="line">命名空间  1 在shell语言中命名空间函数内和函数外是一致的,函数内外不能赋值同样名字的变量</span><br><span class="line">	local  1 声明一个本地变量(局部变量) </span><br><span class="line">返回值</span><br><span class="line">	return value </span><br><span class="line">	value不能超过0-255</span><br></pre></td></tr></table></figure>

<h5 id="shell-函数function"><a href="#shell-函数function" class="headerlink" title="shell 函数function"></a>shell 函数function</h5><p>函数声明</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function_name () &#123;</span><br><span class="line">   list of commands</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>函数名 function_name，这就是你将使用它从其他地方在你的脚本调用。</p>
<p>取消函数</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unset myfunc //取消函数</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">myfunc()  //函数定义</span><br><span class="line">&#123;</span><br><span class="line">echo “This is my first shell function” </span><br><span class="line">&#125;</span><br><span class="line">myfunc    //函数调用</span><br></pre></td></tr></table></figure>

<p>产生以下执行结果</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./test.sh</span><br><span class="line">This is my first shell function</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">函数必须提前定义测试</span><br><span class="line">[root@newrain fun]# cat fun05.sh </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">fun () &#123;</span><br><span class="line">echo &quot;hello&quot;</span><br><span class="line">&#125;</span><br><span class="line">fun</span><br><span class="line">unset fun</span><br><span class="line">fun</span><br><span class="line">[root@newrain fun]# bash fun05.sh</span><br><span class="line">hello</span><br><span class="line">fun05.sh: line 8: fun: command not found</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">函数的返回值，返回的是函数体内最后一条命令是否成功的返回值</span><br><span class="line">[root@newrain fun]# systemctl stop httpd </span><br><span class="line">[root@newrain fun]# cat fun03.sh </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">fun() &#123;</span><br><span class="line">        systemctl status httpd &amp;&gt;/dev/null</span><br><span class="line">        systemctl status vsftpd &amp;&gt;/dev/null</span><br><span class="line">&#125;</span><br><span class="line">fun </span><br><span class="line">echo $?</span><br><span class="line">[root@newrain fun]# systemctl stop vsftpd</span><br><span class="line">[root@newrain fun]# bash fun03.sh </span><br><span class="line">3</span><br></pre></td></tr></table></figure>

<p>函数传参<br>在Shell中，调用函数时可以向其传递参数。在函数体内部，通过 $n 的形式来获取参数的值，例如，$1表示第一个参数，$2表示第二个参数</p>
<p>示例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@newrain fun]# cat fun06.sh </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">fun() &#123;</span><br><span class="line">        echo $[$1*$2*$3]</span><br><span class="line">&#125;</span><br><span class="line">fun 1 2 3</span><br><span class="line">修改版:</span><br><span class="line">[root@newrain fun]# cat fun06.sh </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">if [ ! $# -eq 3 ];then</span><br><span class="line">        echo &quot;Must Input Three number: p1 p2 p3&quot;</span><br><span class="line">exit fi</span><br><span class="line">fun() &#123;</span><br><span class="line">        echo $[$1*$2*$3]</span><br><span class="line">&#125;</span><br><span class="line">fun $1 $2 $3</span><br></pre></td></tr></table></figure>

<h3 id="九、shell-编程-数组"><a href="#九、shell-编程-数组" class="headerlink" title="九、shell 编程-数组"></a>九、shell 编程-数组</h3><p>普通数组:只能用整数作为数组的索引<br>关联数组:可以使用字符串作为数组的索引</p>
<h5 id="数组定义"><a href="#数组定义" class="headerlink" title="数组定义"></a>数组定义</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">普通数组定义:</span><br><span class="line">[root@newrain shell]# books=( linux shell awk sed )  </span><br><span class="line">引用:</span><br><span class="line">[root@newrain shell]# echo $&#123;books[0]&#125;</span><br><span class="line">linux</span><br><span class="line">[root@newrain shell]# echo $&#123;books[1]&#125;</span><br><span class="line">shell</span><br><span class="line">[root@newrain shell]# echo $&#123;books[2]&#125;</span><br><span class="line">awk</span><br><span class="line"></span><br><span class="line">关联数组需要提前声明</span><br><span class="line">declare -A myarry1</span><br><span class="line">[root@newrain shell]# declare -A myarry1</span><br><span class="line">[root@newrain shell]# myarry1=([name]=newrain [sex]=man [age]=26) </span><br><span class="line">[root@newrain shell]# echo $&#123;myarry1[name]&#125;</span><br><span class="line">newrain</span><br><span class="line">[root@newrain shell]# echo $&#123;myarry1[age]&#125;</span><br><span class="line">26</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">定义方法1:</span><br><span class="line">    # declare -a myarry=(5 6 7 8) </span><br><span class="line">    # echo $&#123;myarry[2]&#125;</span><br><span class="line">		显示结果为 7</span><br><span class="line">		</span><br><span class="line">定义方法2:</span><br><span class="line">    # array=( one two three four five six )</span><br><span class="line">    # array2=(tom jack alice)</span><br><span class="line">    # array3=(`cat /etc/passwd`)</span><br><span class="line">    # array4=(tom jack alice &quot;bash shell&quot;)</span><br><span class="line">    # array5=(1 2 3 4 5 6 7 &quot;linux shell&quot; [20]=saltstack)</span><br><span class="line">    </span><br><span class="line">定义方法3: # 普通数组下标只能是数字</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span> </span><br><span class="line">area[11]=23 </span><br><span class="line">area[13]=37 </span><br><span class="line">area[51]=&quot;UFOs&quot;</span><br></pre></td></tr></table></figure>

<h5 id="访问数组"><a href="#访问数组" class="headerlink" title="访问数组"></a>访问数组</h5><p>当设置任何数组变量时，可以访问它</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@newrain shell]# aa=(haha heihei baibai)</span><br><span class="line">[root@newrain shell]# echo $&#123;aa[0]&#125;    //访问数组中的第一个元素</span><br><span class="line">[root@newrain shell]# echo $&#123;aa[@]&#125; 		//访问数组中所有的元素，等同与echo $&#123;aa[*]&#125;</span><br><span class="line">[root@newrain shell]# echo $&#123;#aa[@]&#125;   //统计元素的个数</span><br><span class="line">[root@newrain shell]# echo $&#123;!aa[@]&#125;   //统计索引</span><br></pre></td></tr></table></figure>

<p><code>$&#123;array_name[index]&#125; //引用</code></p>
<p>示例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">NAME[0]=&quot;BJ&quot;</span><br><span class="line">NAME[1]=&quot;SH&quot;</span><br><span class="line">NAME[2]=&quot;SZ&quot;</span><br><span class="line">NAME[3]=&quot;GZ&quot;</span><br><span class="line">NAME[4]=&quot;HZ&quot;</span><br><span class="line">NAME[5]=&quot;ZZ&quot;</span><br><span class="line">echo &quot;First Index: $&#123;NAME[0]&#125;&quot;</span><br><span class="line">echo &quot;Second Index: $&#123;NAME[1]&#125;&quot;</span><br><span class="line">echo &quot;sixth Index: $&#123;NAME[5]&#125;&quot;</span><br></pre></td></tr></table></figure>

<p>输出结果为</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"> $</span><span class="language-bash">./test.sh</span></span><br><span class="line">First Index: BJ </span><br><span class="line">Second Index: SH </span><br><span class="line">sixth Index: ZZ</span><br></pre></td></tr></table></figure>

<p>您可以访问数组中的所有项目通过以下方式之一:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;array_name[*]&#125;</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;array_name[@]&#125;</span></span><br></pre></td></tr></table></figure>

<p>示例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">NAME[0]=&quot;BJ&quot;</span><br><span class="line">NAME[1]=&quot;SH&quot;</span><br><span class="line">NAME[2]=&quot;SZ&quot;</span><br><span class="line">NAME[3]=&quot;GZ&quot;</span><br><span class="line">NAME[4]=&quot;HZ&quot;</span><br><span class="line">echo &quot;First Index: $&#123;NAME[*]&#125;&quot;</span><br><span class="line">echo &quot;Second Index: $&#123;NAME[@]&#125;&quot;</span><br></pre></td></tr></table></figure>

<p>输出结果</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"> $</span><span class="language-bash">./test.sh</span></span><br><span class="line">First Index: BJ SH SZ GZ HZ </span><br><span class="line">Second Index: BJ SH SZ GZ HZ</span><br></pre></td></tr></table></figure>

<p>疑难点<br>shell数组中”*” 和 “@” 区别</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">关于在shell脚本中数组变量中 “*”跟 “@” 区别</span><br><span class="line">“*”当变量加上“” 会当成一串字符串处理. </span><br><span class="line">“@”变量加上“” 依然当做数组处理. </span><br><span class="line">在没有加上“” 的情况下 效果是等效的.</span><br></pre></td></tr></table></figure>

<p>示例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env bash</span><br><span class="line">array=(gz cloud 19)</span><br><span class="line">echo &quot;case 1&quot;</span><br><span class="line">for line in &quot;$&#123;array[@]&#125;&quot;</span><br><span class="line">do</span><br><span class="line">		echo $line</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">echo &quot;case 2&quot;</span><br><span class="line">for line in &quot;$&#123;array[*]&#125;&quot;</span><br><span class="line">do</span><br><span class="line">		echo $line</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">echo &quot;case 3&quot;</span><br><span class="line">for line in $&#123;array[*]&#125;</span><br><span class="line">do</span><br><span class="line">		echo $line</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">echo &quot;case 4&quot;</span><br><span class="line">for line in $&#123;array[@]&#125;</span><br><span class="line">do</span><br><span class="line">		echo $line</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">case 1</span><br><span class="line">gz</span><br><span class="line">cloud</span><br><span class="line">19</span><br><span class="line">case 2</span><br><span class="line">gz cloud 19</span><br><span class="line">case 3</span><br><span class="line">gz</span><br><span class="line">cloud</span><br><span class="line">19</span><br><span class="line">case 4</span><br><span class="line">gz</span><br><span class="line">cloud</span><br><span class="line">19</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">遍历数组while</span><br><span class="line">[root@newrain array]# cat array01.sh </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">++ i 是先自加1后赋值;i ++ 是先赋值后自加1。</span> </span><br><span class="line">while read line</span><br><span class="line">do     </span><br><span class="line">        host[i++]=$line  # 观察i++ 和 ++i的区别</span><br><span class="line">done &lt;/etc/hosts</span><br><span class="line">for i in $&#123;!host[@]&#125;   # 数组的元素索引</span><br><span class="line">do</span><br><span class="line">        echo &quot;$i:$&#123;host[i]&#125;&quot;</span><br><span class="line">done</span><br><span class="line">遍历数组for</span><br><span class="line">[root@newrain array]# cat array02.sh </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">IFS=&#x27;&#x27;</span><br><span class="line">for line in `cat /etc/hosts`  # 读取文件中的每一行</span><br><span class="line">do</span><br><span class="line">        host[j++]=$line</span><br><span class="line">done</span><br><span class="line">for i in $&#123;!host[@]&#125;</span><br><span class="line">do</span><br><span class="line">        echo $&#123;host[i]&#125;</span><br><span class="line">done </span><br><span class="line">以上两个脚本都是读取文件中的行，然后加到一个数组中并进行遍历。</span><br><span class="line"></span><br><span class="line">练习题:统计shell的种类和数量</span><br><span class="line">思路：最后一列的sh种类不同，我们可以单独取出最后一列 /etc/passwd</span><br></pre></td></tr></table></figure>

<h3 id="十、正则表达式RE"><a href="#十、正则表达式RE" class="headerlink" title="十、正则表达式RE"></a>十、正则表达式RE</h3><hr>
<hr>
<p>正则表达式基本元字符</p>
<p>正则表达式拓展元字符</p>
<p>用来处理文本</p>
<blockquote>
<p>正则表达式(Regular Expression, RE)是一种字符模式, 用于在查找过程中匹配指定的字符. 在大多数程序里, 正则表达式都被置于两个正斜杠之间;</p>
<p>例如&#x2F;l[oO]ve&#x2F;就是由正斜杠界定的正则表达式, 它将匹配被查找的行中任何位置出现的相同模式. 在正则表达式中,元 字符是最重要的概念</p>
<p>元字符使正则表达式具有处理能力。所谓元字符就是指ß那些在正则表达式中具有特殊意义的专用字符，可以用来规定 其前导字符(即位于元字符前面的字符)在目标对象中的出现模式。</p>
</blockquote>
<h5 id="No-1-正则表达式基本元字符"><a href="#No-1-正则表达式基本元字符" class="headerlink" title="No.1 正则表达式基本元字符"></a>No.1 正则表达式基本元字符</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">基本正则表达式元字符 </span><br><span class="line">元字符</span><br><span class="line">示例                      功能</span><br><span class="line">^                       行首定位符</span><br><span class="line">^love </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">                      行尾定位符</span></span><br><span class="line"><span class="meta prompt_">love$ </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"></span></span><br><span class="line">.                       匹配单个字符</span><br><span class="line">l..e  </span><br><span class="line"></span><br><span class="line">*                       匹配前导符0到多次</span><br><span class="line">ab*love </span><br><span class="line"></span><br><span class="line">.*                      匹配任意多个字符  (贪婪匹配</span><br><span class="line"></span><br><span class="line">[]                      匹配方括号中任意一个字符</span><br><span class="line">[lL]ove</span><br><span class="line"></span><br><span class="line">[ - ]                   匹配指定范围内的一个字符</span><br><span class="line">[a-z0-9]ove             </span><br><span class="line"></span><br><span class="line">[^]                     匹配不在指定组里的字符</span><br><span class="line">[^a-z0-9]ove </span><br><span class="line"></span><br><span class="line">\                       用来转义元字符</span><br><span class="line">love\.                  </span><br><span class="line"></span><br><span class="line">\&lt;                      词首定位符 #由数组或字母组成的</span><br><span class="line">\&lt;love</span><br><span class="line"></span><br><span class="line">\&gt;                      词尾定位符</span><br><span class="line">love\&gt;</span><br><span class="line"></span><br><span class="line">\(\)                    匹配后的标签   # 在vim中测试</span><br></pre></td></tr></table></figure>

<h5 id="No-2正则表达式拓展元字符"><a href="#No-2正则表达式拓展元字符" class="headerlink" title="No.2正则表达式拓展元字符"></a>No.2正则表达式拓展元字符</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">= 等于 != 不等于  =~  匹配</span><br><span class="line">扩展正则表达式元字符</span><br><span class="line">+                       匹配一个或多个前导字符</span><br><span class="line">[a-z]+ove</span><br><span class="line"></span><br><span class="line">?                       匹配零个或一个前导字符 </span><br><span class="line">lo?ve</span><br><span class="line"></span><br><span class="line">a|b                     匹配a或b</span><br><span class="line">love|hate</span><br><span class="line"></span><br><span class="line">()                      组字符loveable|rs</span><br><span class="line">love(able|rs) ov+ ov+ (ov)+ </span><br><span class="line"></span><br><span class="line">(..)(..)\1\2            标签匹配字符  #</span><br><span class="line">(love)able\1er</span><br><span class="line"></span><br><span class="line">x&#123;m&#125;                    字符x重复m次</span><br><span class="line">o&#123;5&#125;</span><br><span class="line"></span><br><span class="line">x&#123;m,&#125;                   字符x重复至少m次</span><br><span class="line">o&#123;5,&#125;</span><br><span class="line"></span><br><span class="line">x&#123;m,n&#125;                  字符x重复m到n次</span><br><span class="line">o&#123;5,10&#125;</span><br></pre></td></tr></table></figure>

<h3 id="十一、shell-编程-grep"><a href="#十一、shell-编程-grep" class="headerlink" title="十一、shell 编程-grep"></a>十一、shell 编程-grep</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">egrep 支持正则表达式的拓展元字符 （或grep  -E）</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">egrep <span class="string">&#x27;[0-9]&#123;1,3&#125;.[0-9]&#123;1,3&#125;.[0-9]&#123;1,3&#125;.[0-9]&#123;1,3&#125;&#x27;</span> file1.txt</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line">[root@newrain ~]# num1=1 </span><br><span class="line">1、运用正则，判断需要[[ ]] </span><br><span class="line">[root@newrain ~]# [[ $num1 =~ ^[0-9]+$ ]] &amp;&amp; echo &quot;yes&quot; || echo &quot;no&quot;</span><br><span class="line">yes</span><br><span class="line">[root@newrain ~]# num3=1b1 </span><br><span class="line">[root@newrain ~]# [[ $num3 =~ ^[0-9]+$ ]] &amp;&amp; echo &quot;yes&quot; || echo &quot;no&quot;</span><br><span class="line">no</span><br><span class="line">[root@newrain ~]# [[ $num =~ ^[0-9]+\.[0-9]+$ || $num =~ ^[0-9]+$ ]] &amp;&amp; echo &quot;yes&quot; || echo &quot;no&quot;       //输入的只能是数字(包括小数)</span><br><span class="line"></span><br><span class="line">2、* 0或多个</span><br><span class="line">[root@newrain ~]# useradd abrt </span><br><span class="line">[root@newrain ~]# grep &#x27;abc*&#x27; /etc/passwd </span><br><span class="line">abrt:x:1041:1041::/home/abrt:/bin/bash</span><br><span class="line"></span><br><span class="line">3、\&lt; 词首定位符号 \&gt;词尾定位符号 </span><br><span class="line">[root@newrain ~]# cat jack.txt </span><br><span class="line">Jack JACK JAck jackly</span><br><span class="line">:% s/\&lt;[Jj]ack\&gt;/123/g</span><br><span class="line"></span><br><span class="line">4、^以什么开头</span><br><span class="line">[root@newrain ~]# grep &#x27;^root&#x27; /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line"></span><br><span class="line">5、$以什么结尾</span><br><span class="line">[root@newrain ~]# grep &#x27;bash$&#x27; /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">confluence:x:1000:1000:Atlassian Confluence:/home/confluence:/bin/bash </span><br><span class="line">to:x:1003:1003::/home/to:/bin/bash</span><br><span class="line"></span><br><span class="line">6、. 匹配单个字符</span><br><span class="line">[root@newrain ~]# grep &#x27;r..t&#x27; /etc/passwd </span><br><span class="line">root:x:0:0:root:/root:/bin/bash </span><br><span class="line">operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line">ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin </span><br><span class="line">dockerroot:x:998:995:Docker User:/var/lib/docker:/sbin/nologin </span><br><span class="line">[root@newrain ~]# grep &#x27;r.t&#x27; /etc/passwd </span><br><span class="line">operator:x:11:0:operator:/root:/sbin/nologin </span><br><span class="line">sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin</span><br><span class="line"></span><br><span class="line">7、.* 任意多个字符</span><br><span class="line">[root@newrain ~]# grep &#x27;r.*t&#x27; /etc/passwd </span><br><span class="line">root:x:0:0:root:/root:/bin/bash </span><br><span class="line">operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line">ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin </span><br><span class="line">systemd-network:x:192:192:systemd Network Management:/:/sbin/nologin polkitd:x:999:997:User for polkitd:/:/sbin/nologin postfix:x:89:89::/var/spool/postfix:/sbin/nologin </span><br><span class="line">sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin dockerroot:x:998:995:Docker User:/var/lib/docker:/sbin/nologin </span><br><span class="line">tss:x:59:59:Account used by the trousers package to sandbox the tcsd daemon:/dev/null:/sbin/nologin</span><br><span class="line">apache:x:48:48:Apache:/usr/share/httpd:/sbin/nologin</span><br><span class="line">abrt:x:1041:1041::/home/abrt:/bin/</span><br><span class="line"></span><br><span class="line">8、[] 匹配方括号中的任意一个字符</span><br><span class="line">[root@newrain ~]# grep &#x27;Root&#x27; /etc/passwd</span><br><span class="line">[root@newrain ~]# grep &#x27;[Rr]oot&#x27; /etc/passwd </span><br><span class="line">root:x:0:0:root:/root:/bin/bash </span><br><span class="line">operator:x:11:0:operator:/root:/sbin/nologin </span><br><span class="line">dockerroot:x:998:995:Docker User:/var/lib/docker:/sbin/nologin</span><br><span class="line"></span><br><span class="line">9、[ - ] 匹配指定范围内的一个字符</span><br><span class="line">[root@newrain ~]# grep [a-z]oot /etc/passwd </span><br><span class="line">root:x:0:0:root:/root:/bin/bash </span><br><span class="line">operator:x:11:0:operator:/root:/sbin/nologin </span><br><span class="line">dockerroot:x:998:995:Docker User:/var/lib/docker:/sbin/nologin</span><br><span class="line"></span><br><span class="line">10、[^] 匹配不在指定组内的字符,取反得意思</span><br><span class="line">[root@newrain ~]# grep &#x27;[^0-9]oot&#x27; /etc/passwd </span><br><span class="line">root:x:0:0:root:/root:/bin/bash </span><br><span class="line">operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line">dockerroot:x:998:995:Docker User:/var/lib/docker:/sbin/nologin</span><br><span class="line"></span><br><span class="line">[root@newrain ~]# grep &#x27;[^0-9A-Z]oot&#x27; /etc/passwd </span><br><span class="line">root:x:0:0:root:/root:/bin/bash </span><br><span class="line">operator:x:11:0:operator:/root:/sbin/nologin </span><br><span class="line">dockerroot:x:998:995:Docker User:/var/lib/docker:/sbin/nologin</span><br><span class="line">[root@newrain ~]# grep &#x27;[^0-9A-Za-z]oot&#x27; /etc/passwd</span><br><span class="line">[root@newrain ~]#</span><br><span class="line">[root@newrain ~]# useradd Root</span><br><span class="line">[root@newrain ~]# grep &#x27;[a-z]oot&#x27; /etc/passwd      </span><br><span class="line">root:x:0:0:root:/root:/bin/bash </span><br><span class="line">operator:x:11:0:operator:/root:/sbin/nologin </span><br><span class="line">dockerroot:x:998:995:Docker User:/var/lib/docker:/sbin/nologin Root:x:1042:1042::/home/Root:/bin/bash</span><br><span class="line">[root@newrain ~]# grep &#x27;^[rc]oot&#x27; /etc/passwd </span><br><span class="line">root:x:0:0:root:/root:/bin/bash </span><br><span class="line">^在[]内表示取反，^在[]外表示以什么开头</span><br><span class="line"></span><br><span class="line">11、\(\)匹配后的标签</span><br><span class="line">[root@newrain ~]# cat file1.txt </span><br><span class="line">IPADDR=192.168.1.123 </span><br><span class="line">GATEWAY=192.168.1.1 </span><br><span class="line">NETMASK=255.255.255.0 </span><br><span class="line">DNS=114.114.114.114</span><br><span class="line">:% s#\(192.168.1.\)123#\12#</span><br><span class="line">:% s#\(192.\)\(168.\)\(1.\)2#\1\2\35#</span><br><span class="line">:% s\(192.\)\(168.\)\(1.\)\(5\)#\1\26.\4#</span><br><span class="line"></span><br><span class="line">扩展正则表达式元字符</span><br><span class="line">+                       匹配一个或多个前导字符</span><br><span class="line">[a-z]+ove</span><br><span class="line">?                       匹配零个或一个前导字符 </span><br><span class="line">lo?ve</span><br><span class="line">a|b                     匹配a或b</span><br><span class="line">love|hate</span><br><span class="line">(..)(..)\1\2            标签匹配字符</span><br><span class="line">(love)able\1er</span><br><span class="line">x&#123;m&#125;                    字符x重复m次</span><br><span class="line">o&#123;5</span><br><span class="line">x&#123;m,&#125;                   字符x重复至少m次</span><br><span class="line">o&#123;5,&#125;</span><br><span class="line">x&#123;m,n&#125;                  字符x重复m到n次</span><br><span class="line">o&#123;5,10&#125;</span><br><span class="line"></span><br><span class="line">1、+ 匹配一个或多个前导字符</span><br><span class="line">[root@newrain ~]# egrep &#x27;ro+t&#x27; /etc/passwd </span><br><span class="line">root:x:0:0:root:/root:/bin/bash </span><br><span class="line">operator:x:11:0:operator:/root:/sbin/nologin </span><br><span class="line">dockerroot:x:998:995:Docker User:/var/lib/docker:/sbin/nologin</span><br><span class="line">2、? 匹配零个或一个前导字符</span><br><span class="line">[root@newrain ~]# egrep &#x27;ro?t&#x27; /etc/passwd </span><br><span class="line">abrt:x:1041:1041::/home/abrt:/bin/bash</span><br><span class="line"></span><br><span class="line">3、a|b    匹配a或b</span><br><span class="line">[root@newrain ~]# netstat -anlp|egrep &#x27;:80|:22&#x27;</span><br><span class="line">[root@newrain ~]# egrep &#x27;root|alice&#x27; </span><br><span class="line">/etc/passwd root:x:0:0:root:/root:/bin/bash </span><br><span class="line">operator:x:11:0:operator:/root:/sbin/nologin </span><br><span class="line">dockerroot:x:998:995:Docker User:/var/lib/docker:/sbin/nologin</span><br><span class="line"></span><br><span class="line">4、x&#123;m&#125; 字符x重复m次 </span><br><span class="line">[root@newrain ~]# cat a.txt</span><br><span class="line">love</span><br><span class="line">love.</span><br><span class="line">loove</span><br><span class="line">looooove </span><br><span class="line">[root@newrain ~]# egrep &#x27;o&#123;2&#125;&#x27; a.txt</span><br><span class="line">loove</span><br><span class="line">looooove </span><br><span class="line">[root@newrain ~]# egrep &#x27;o&#123;2,&#125;&#x27; a.txt</span><br><span class="line">loove</span><br><span class="line">looooove </span><br><span class="line">[root@newrain ~]# egrep &#x27;o&#123;6,7&#125;&#x27; a.txt</span><br></pre></td></tr></table></figure>

<h3 id="十二、shell-编程-SED"><a href="#十二、shell-编程-SED" class="headerlink" title="十二、shell 编程-SED"></a>十二、shell 编程-SED</h3><hr>
<p>非交互式编辑器，一次处理一行内容。(流文本编辑器)</p>
<hr>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed &quot;参数&quot;  &#x27;模式&#x27;</span><br><span class="line">参数  1 -f 指定一个规则文件 2 -n 阻止输入行输出 -r 扩展正则</span><br><span class="line">模式  1 s 替换  2 g 整行(也可以是数字，替换第几个) 3 d 删除 4 p 打印 5 a 追加 6 i 是插入</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">示例文件</span><br><span class="line">file1.txt</span><br><span class="line">John Daggett, 341 King Road, Plymouth MA</span><br><span class="line">Alice Ford, 22 East Broadway, Richmond VA </span><br><span class="line">Orville Thomas, 11345 Oak Bridge Road, Tulsa OK </span><br><span class="line">Terry Kalkas, 402 Lans Road, Beaver Falls PA </span><br><span class="line">Eric Adams, 20 Post Road, Sudbury MA</span><br><span class="line">Hubert Sims, 328A Brook Road, Roanoke VA</span><br><span class="line">Amy Wilde, 334 Bayshore Pkwy, Mountain View CA </span><br><span class="line">Sal Carpenter, 73 6th Street, Boston MA</span><br><span class="line"></span><br><span class="line">用Massachusetts替换MA:  #前面两个斜杠中是要匹配的内容，可以使用正则,后面两个斜杠中间，是要替换的内容，是纯文本</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">sed <span class="string">&#x27;s/MA/Massachusetts/&#x27;</span> file1.txt</span></span><br><span class="line">使用多重指令:</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sed <span class="string">&#x27;s/MA/Massachusetts/ ; s/PA/Pennsylvania/&#x27;</span> file1.txt</span></span><br><span class="line">使用脚本文件: </span><br><span class="line">脚本:namestate </span><br><span class="line">s/MA/Massachusetts/ </span><br><span class="line">s/PA/Pennsylvania/ </span><br><span class="line">s/CA/California/ </span><br><span class="line">s/VA/Virginia/ </span><br><span class="line">s/OK/Oklahoma/</span><br><span class="line">-f&lt;script文件&gt;或--file=&lt;script文件&gt; 以选项中指定的script文件来处理输入的文本文件。 </span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sed -f namestate file1.txt</span></span><br><span class="line">保存输出:</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sed -f namestate file1.txt &gt; newfile.txt</span></span><br><span class="line">阻止输入行自动显示:</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sed -n <span class="string">&#x27;s/MA/Massachusetts/p&#x27;</span> file1.txt</span></span><br></pre></td></tr></table></figure>

<h5 id="sed流编辑器用法及解析"><a href="#sed流编辑器用法及解析" class="headerlink" title="sed流编辑器用法及解析"></a>sed流编辑器用法及解析</h5><p>sed: stream editor(流编辑器)的缩写. 它们最常见的用法是进行文本的替换.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">[root@newrain ~]# sed &#x27;1d&#x27; passwd //删除文件的第1行 </span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin </span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">[root@newrain ~]# sed &#x27;1,2d&#x27; passwd //删除文件的第1到2行 daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">[root@newrain ~]# cat e.txt</span><br><span class="line">/etc/abc/456</span><br><span class="line">etc</span><br><span class="line">[root@newrain ~]# sed -r &#x27;s#/etc/abc#/var/lib#&#x27; e.txt </span><br><span class="line">/var/lib/456</span><br><span class="line">etc</span><br><span class="line">[root@newrain ~]# cat passwd </span><br><span class="line">root:x:0:0:root:/root:/bin/bash </span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin </span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin </span><br><span class="line">[root@newrain ~]# sed &#x27;2,$d&#x27; passwd       //删除第2行到最后一行s</span><br><span class="line">root:x:0:0:root:/root:/bin/bash </span><br><span class="line">[root@newrain ~]# sed &#x27;/root/d&#x27; passwd    //匹配到root，删除此行</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin </span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin </span><br><span class="line">[root@newrain ~]# sed &#x27;/root/,2d&#x27; passwd  //匹配到root行，到某一行</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line"></span><br><span class="line">[root@newrain ~]# cat -n passwd</span><br><span class="line">    1 root:x:0:0:root:/root:/bin/bash</span><br><span class="line">    2 bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">    3 daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">    4 adm:x:3:4:adm:/var/adm:/sbin/nologin</span><br><span class="line">    5 lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin</span><br><span class="line">    6 sync:x:5:0:sync:/sbin:/bin/sync</span><br><span class="line">    7 shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown</span><br><span class="line">    8 halt:x:7:0:halt:/sbin:/sbin/halt</span><br><span class="line">    9 mail:x:8:12:mail:/var/spool/mail:/sbin/nologin</span><br><span class="line">    10 operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line">[root@newrain ~]# sed &#x27;1~2d&#x27; passwd   //删除奇数行</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin </span><br><span class="line">adm:x:3:4:adm:/var/adm:/sbin/nologin </span><br><span class="line">sync:x:5:0:sync:/sbin:/bin/sync </span><br><span class="line">halt:x:7:0:halt:/sbin:/sbin/halt </span><br><span class="line">operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line"></span><br><span class="line">[root@newrain ~]# sed &#x27;0~2d&#x27; passwd    //删除偶数行</span><br><span class="line">root:x:0:0:root:/root:/bin/bash  </span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin </span><br><span class="line">lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown mail:x:8:12:mail:/var/spool/mail:/sbin/nologin</span><br></pre></td></tr></table></figure>

<ol>
<li><p>sed可以从stdin中读取内容<br><code>$ cat filename | sed &#39;s/pattern/replace_string/&#39;</code> </p>
</li>
<li><p>选项 -i 会使得sed用修改后的数据替换原文件<br><code>$ sed -i &#39;s/pattern/replace_string/&#39; filename</code> </p>
</li>
<li><p>g标记可以使sed执行全局替换 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sed <span class="string">&#x27;s/pattern/replace_string/g&#x27;</span> filename</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sed <span class="string">&#x27;s/pattern/replace_string/gi&#x27;</span> filename //忽略大小写替换</span></span><br></pre></td></tr></table></figure>

</li>
<li><p>g标记可以使sed匹配第N次以后的字符被替换<br><code>$ echo &quot;thisthisthisthis&quot; | sed &#39;s/this/THIS/2g&#39;</code> </p>
</li>
<li><p>sed中的分隔符可以替换成别的字符, 因为s标识会认为后面的字符为分隔符 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sed <span class="string">&#x27;s:text:replace_text:&#x27;</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sed <span class="string">&#x27;s|text|replace_text|&#x27;</span></span></span><br></pre></td></tr></table></figure>

</li>
<li><p>sed可以利用指令来删除文件中的空行<br><code>$ sed &#39;/^$/d&#39; filename</code> </p>
</li>
<li><p>由于在使用 -i 参数时比较危险, 所以我们在使用i参数时在后面加上.bak就会产生一个filename.bak备份的文件,以防后悔<br><code>sed -i.bak &#39;s/pattern/replace_string/&#39; filename</code> </p>
</li>
<li><p>sed如果在脚本中使用的话, 不可避免的要调用变量, 所以以下这种方式可以用来调用变量即’ ‘换成了” “ </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">text=hello</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">echo</span> <span class="string">&quot;hello world&quot;</span> | sed <span class="string">&quot;s/<span class="variable">$text</span>/HELLO/&quot;</span></span></span><br></pre></td></tr></table></figure>

</li>
<li><p>在文件中匹配到的部分前后加上一行</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed &#x27;/^bin/a\hello nihao/&#x27; passwd  # 在匹配到开头为bin的行下一行插入内容</span><br><span class="line"></span><br><span class="line">sed &#x27;/^bin/i\hello nihao/&#x27; passwd  # 在匹配到开头为bin的行上一行插入内容</span><br></pre></td></tr></table></figure>

<h3 id="十三、shell-编程-AWK"><a href="#十三、shell-编程-AWK" class="headerlink" title="十三、shell 编程-AWK"></a>十三、shell 编程-AWK</h3><p><strong>awk是行处理器</strong>: 相比较屏幕处理的优点，在处理庞大文件时不会出现内存溢出或是处理缓慢的问题，通常用来格式化文本信息<br><strong>awk处理过程</strong>: 依次对每一行进行处理，然后输出 默认分隔符是空格或者tab键</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">awk 参数 &#x27;BEGIN&#123;处理之前要做的&#125; &#123;处理内容&#125; END&#123;处理之后的内容&#125;&#x27;</span><br><span class="line">BEGIN&#123;&#125; &#123;&#125;</span><br><span class="line">行处理前</span><br><span class="line">END&#123;&#125;</span><br><span class="line">行处理 行处理后</span><br><span class="line">[root@newrain ~]# awk &#x27;BEGIN&#123;print 1/2&#125; &#123;print &quot;ok&quot;&#125; END&#123;print &quot;----&quot;&#125;&#x27; /etc/hosts  # 打印的内容加上双引号</span><br><span class="line">0.5</span><br><span class="line">ok</span><br><span class="line">ok</span><br><span class="line">ok</span><br><span class="line">ok </span><br><span class="line">ok</span><br><span class="line">ok</span><br><span class="line">----</span><br><span class="line"></span><br><span class="line">awk工作原理</span><br><span class="line">awk -F&quot;:&quot; &#x27;&#123;print $1,$3&#125;&#x27; /etc/passwd </span><br><span class="line">(1)awk使用一行作为输入，并将这一行赋给变量$0,每一行可称作为一个记录，以换行符结束</span><br><span class="line">(2)然后，行被:分解成字段，每个字段存储在已编号的变量中，从$1开始 </span><br><span class="line">(3)awk如何知道空格来分隔字段的呢?因为有一个内部变量FS来确定字段分隔符，初始时，FS赋为空格或者是tab </span><br><span class="line">(4)awk打印字段时，将以设置的方法，使用print函数打印，awk在打印的字段间加上空格，因为$1,$3间有一个,逗号。逗 号比较特殊，映射为另一个变量，成为输出字段分隔符OFS，OFS默认为空格 </span><br><span class="line">(5)awk打印字段时，将从文件中获取每一行，并将其存储在$0中，覆盖原来的内容，然后将新的字符串分隔成字段并进行处理。该过程持续到处理文件结束。</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">默认分隔符是空格或者tab键</span><br><span class="line">awk中的特殊变量:</span><br><span class="line">常用:</span><br><span class="line">- NR: 表示记录编号, 当awk将行为记录时, 该变量相当于当前行号 </span><br><span class="line">- NF: 表示字段数量, 当awk将行为记录时, 该变量相当	于当前列号</span><br><span class="line">难理解:</span><br><span class="line">FS(输入字段分隔符)   # 以什么符号去分割</span><br><span class="line">OFS(输出字段分隔符)  # 以什么分隔符显示</span><br><span class="line">NR(Number of record)行数  </span><br><span class="line">FNR按不同的文件分开 </span><br><span class="line">RS(输入记录分隔符) </span><br><span class="line">ORS(输出记录分隔符)</span><br><span class="line">NF 字段个数</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">FS(输入字段分隔符) (filed sign)</span><br><span class="line">[root@newrain ~]# awk &#x27;BEGIN&#123;FS=&quot;:&quot;&#125; &#123;print $1&#125;&#x27; /etc/passwd </span><br><span class="line">root</span><br><span class="line">bin</span><br><span class="line">daemon</span><br><span class="line">adm</span><br><span class="line">lp</span><br><span class="line">sync</span><br><span class="line">shutdown</span><br><span class="line">halt</span><br><span class="line">mail</span><br><span class="line">operator</span><br><span class="line">games</span><br><span class="line">OFS(输出字段分隔符)        (output filed sign)</span><br><span class="line">[root@newrain ~]# awk &#x27;BEGIN&#123;FS=&quot;:&quot;;OFS=&quot;..&quot;&#125; &#123;print $1,$2&#125;&#x27; /etc/passwd </span><br><span class="line">root..x</span><br><span class="line">bin..x </span><br><span class="line">daemon..x </span><br><span class="line">adm..x </span><br><span class="line">lp..x </span><br><span class="line">sync..x </span><br><span class="line">shutdown..x</span><br><span class="line"></span><br><span class="line">NR 表示记录编号, 当awk将行为记录时, 该变量相当于当前行号 </span><br><span class="line">[root@newrain ~]# awk -F: &#x27;&#123;print NR,$0&#125;&#x27; a.txt file1.txt </span><br><span class="line">1 love</span><br><span class="line">2 love.</span><br><span class="line">3 loove</span><br><span class="line">4 looooove</span><br><span class="line">5</span><br><span class="line">6 isuo</span><br><span class="line">7 IPADDR=192.168.6.5</span><br><span class="line">8 hjahj123</span><br><span class="line">9 GATEWAY=192.168.1.1</span><br><span class="line">10 NETMASK=255.255.255.0</span><br><span class="line">11 DNS=114.114.114.114</span><br><span class="line"></span><br><span class="line">FNR 表示记录编号, 当awk将行为记录时, 该变量相当于当前行号(不同文件分开) </span><br><span class="line">[root@newrain ~]# awk -F: &#x27;&#123;print FNR,$0&#125;&#x27; a.txt file1.txt</span><br><span class="line">1 love</span><br><span class="line">2 love.</span><br><span class="line">3 loove</span><br><span class="line">4 looooove</span><br><span class="line">5</span><br><span class="line">1 isuo</span><br><span class="line">2 IPADDR=192.168.6.5 </span><br><span class="line">3 hjahj123</span><br><span class="line">4 GATEWAY=192.168.1.1</span><br><span class="line">5 NETMASK=255.255.255.0</span><br><span class="line">6 DNS=114.114.114.114</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">RS(输入记录分隔符)</span><br><span class="line">[root@newrain ~]# cat passwd </span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">[root@newrain ~]# awk -F: &#x27;BEGIN&#123;RS=&quot;bash&quot;&#125; &#123;print $0&#125;&#x27; passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/</span><br><span class="line"></span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line"></span><br><span class="line">ORS(输出记录分隔符)</span><br><span class="line">[root@newrain ~]# cat passwd </span><br><span class="line">root:x:0:0:root:/root:/bin/bash </span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin </span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">[root@newrain ~]# awk -F: &#x27;BEGIN&#123;ORS=&quot; &quot;&#125; &#123;print $0&#125;&#x27; passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash bin:x:1:1:bin:/bin:/sbin/nologin  daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line"></span><br><span class="line">练习:将文件合并为一行</span><br><span class="line">[root@newrain ~]# awk &#x27;BEGIN&#123;ORS=&quot;&quot; &#125; &#123;print $0&#125;&#x27; /etc/passwd</span><br><span class="line">练习:把一行内容分为多行</span><br><span class="line">[root@newrain ~]# cat d.txt </span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">[root@newrain ~]# awk &#x27;BEGIN&#123;RS=&quot;:&quot;&#125; &#123;print $0&#125;&#x27; d.txt </span><br><span class="line">root</span><br><span class="line">x</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">root</span><br><span class="line">/root</span><br><span class="line">/bin/bash</span><br></pre></td></tr></table></figure>

<h5 id="AWK使用理解案例"><a href="#AWK使用理解案例" class="headerlink" title="AWK使用理解案例"></a>AWK使用理解案例</h5><ol>
<li><p>打印一个文件中的第2列和第3列</p>
<p> <code>$ awk &#39;&#123; print $2, $3&#125;&#39; filename</code></p>
</li>
<li><p>打印指定行指定列的某个字符</p>
<p> <code>$ awk -F&quot;:&quot; &#39;NR==3&#123; print $7 &#125;&#39; /etc/passwd</code></p>
</li>
<li><p>统计一个文件的行数</p>
<p> <code>$ awk &#39;&#123; print NR&#125;&#39; filename</code></p>
</li>
<li><p>在脚本中, 传递变量到awk中 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">var=1000</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">echo</span> | awk -v VARIABLE=<span class="variable">$var</span> <span class="string">&#x27;&#123; print VARIABLE &#125;&#x27;</span></span></span><br></pre></td></tr></table></figure>

</li>
<li><p>指定字段分隔符-F或在BEGIN{ FS&#x3D;”:” } </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">awk -F: <span class="string">&#x27;&#123; print $2, $3 &#125;&#x27;</span> filename</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">awk <span class="string">&#x27;BEGIN&#123; FS=&quot;:&quot; &#125;&#123; print $2, $3 &#125;&#x27;</span> filename</span></span><br></pre></td></tr></table></figure>

</li>
<li><p>在awk中使用for循环 (了解) </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">每行打印两次</span><br><span class="line">[root@newrain ~]# awk -F: &#x27;&#123;for(i=1;i&lt;=2;i++) &#123;print $0&#125;&#125;&#x27; passwd </span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">分别打印每行每列</span><br><span class="line">[root@newrain ~]# awk -F: &#x27;&#123; for(i=1;i&lt;=NF;i++) &#123;print $i&#125;&#125;&#x27; passwd</span><br></pre></td></tr></table></figure>

</li>
<li><p>在awk中使用if条件判断 （了解） </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">显示管理员用户名</span><br><span class="line">[root@newrain ~]# awk -F: &#x27;&#123;if($3==0) &#123;print $1 &quot; is administrator.&quot;&#125;&#125;&#x27; /etc/passwd</span><br><span class="line">统计系统用户</span><br><span class="line">[root@newrain ~]# awk -F&quot;:&quot; &#x27;&#123;if($3&gt;0 &amp;&amp; $3&lt;1000)&#123;i++&#125;&#125; END&#123;print i&#125;&#x27; /etc/passwd</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="十四、shell-编程-Expect"><a href="#十四、shell-编程-Expect" class="headerlink" title="十四、shell 编程-Expect"></a>十四、shell 编程-Expect</h3><h5 id="No-1-expect的安装"><a href="#No-1-expect的安装" class="headerlink" title="No.1 expect的安装"></a>No.1 expect的安装</h5><p><code>[root@newrain ~]# yum -y install expect</code></p>
<h5 id="No-2-expect的语法"><a href="#No-2-expect的语法" class="headerlink" title="No.2 expect的语法"></a>No.2 expect的语法</h5><p>是一个免费的编程工具, 用来实现自动的交互式任务, 而无需人为干预. 说白了 expect 就是一套用来实现自动交互功能的软件</p>
<p>在实际工作中我们运行命令、脚本或程序时, 这些命令、脚本或程序都需要从终端输入某些继续运行的指令,而这些输 入都需要人为的手工进行. 而利用 expect 则可以根据程序的提示, 模拟标准输入提供给程序, 从而实现自动化交互执 行. 这就是 expect</p>
<p>能够在工作中熟练的使用Shell脚本就可以很大程度的提高工作效率, 如果再搭配上expect,那么很多工作都可以自动化 进行,对工作的展开如虎添翼</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">用法: </span><br><span class="line">1)定义脚本执行的shell</span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">!/usr/bin/expect 类似于#!/bin/bash</span> </span><br><span class="line">2)set timeout 30</span><br><span class="line">		设置超时时间30s </span><br><span class="line">3)spawn</span><br><span class="line">		spawn是进入expect环境后才能执行的内部命令，不能直接在默认的shell环境中执行 </span><br><span class="line">		功能:传递交互命令</span><br><span class="line">4)expect </span><br><span class="line">		这里的expect同样是expect命令</span><br><span class="line">		功能:判断输出结果是否包含某项字符串，没有则立即返回，否则等待一段时间后返回，等待通过timeout设置 </span><br><span class="line">5)send</span><br><span class="line">		执行交互动作，将交互要执行的动作进行输入给交互指令 </span><br><span class="line">		命令字符串结尾要加上“r”，如果出现异常等待状态可以进行核查</span><br><span class="line">6)interact </span><br><span class="line">		执行完后保持交互状态，把控制权交给控制台 </span><br><span class="line">		如果不加这一项，交互完成会自动退出</span><br><span class="line">7)exp_continue </span><br><span class="line">		继续执行接下来的操作</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">expect环境中设置变量用set，识别不了bash方式定义的变量 </span><br><span class="line">错误方式:</span><br><span class="line">[root@newrain expect]# cat expect02.sh </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/expect</span></span><br><span class="line">user=22</span><br><span class="line">spawn echo $user</span><br><span class="line">[root@newrain expect]# ./expect02.sh </span><br><span class="line">invalid command name &quot;user=22&quot;</span><br><span class="line">    while executing</span><br><span class="line">&quot;user=22&quot;</span><br><span class="line">		(file &quot;./expect02.sh&quot; line 3)</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">正确方式:</span><br><span class="line">[root@newrain expect]# cat ./expect02.sh </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/expect</span></span><br><span class="line">set user 22</span><br><span class="line">spawn echo $user</span><br><span class="line">[root@newrain expect]# ./expect02.sh</span><br><span class="line">spawn echo 22 ============================================================================</span><br><span class="line"></span><br><span class="line">[root@newrain expect]# cat expect01.sh </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/expect</span></span><br><span class="line">spawn ssh root@192.168.62.146</span><br><span class="line">expect &#123;</span><br><span class="line">        &quot;yes/no&quot; &#123; send &quot;yes\r&quot;;exp_continue &#125;</span><br><span class="line">        &quot;password:&quot; &#123; send &quot;123\r&quot; &#125;</span><br><span class="line">&#125; </span><br><span class="line">interact</span><br><span class="line"></span><br><span class="line">interact的作用测试</span><br><span class="line">执行测试是否免交互:</span><br><span class="line">要是用/usr/bin/expect的shell执行</span><br><span class="line">[root@newrain expect]#/usr/bin/expect expect01.sh </span><br><span class="line">成功</span><br><span class="line">擦除最后一行interact进行测试</span><br><span class="line">[root@newrain expect]#/usr/bin/expect expect01.sh</span><br><span class="line">进入之后立即退出 ============================================================================</span><br><span class="line">\r的作用测试</span><br><span class="line">[root@newrain expect]# cat expect01.sh </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/expect</span></span><br><span class="line">set user root</span><br><span class="line">set pass 123</span><br><span class="line">set ip 192.168.62.146</span><br><span class="line">spawn ssh $user@$ip</span><br><span class="line">expect &#123;</span><br><span class="line">        &quot;yes/no&quot; &#123; send &quot;yes&quot;;exp_continue &#125;</span><br><span class="line">        &quot;password:&quot; &#123; send &quot;$pass&quot; &#125;</span><br><span class="line">&#125; </span><br><span class="line">interact</span><br><span class="line">[root@newrain expect]# ./expect01.sh </span><br><span class="line">spawn ssh root@192.168.62.146 </span><br><span class="line">root@192.168.62.146&#x27;s password:</span><br><span class="line"></span><br><span class="line">加上\r之后</span><br><span class="line">[root@newrain expect]# ./expect01.sh</span><br><span class="line">spawn ssh root@192.168.62.146</span><br><span class="line">root@192.168.62.146&#x27;s password:</span><br><span class="line">Permission denied, please try again.</span><br><span class="line">root@192.168.62.146&#x27;s password: ============================================================================</span><br><span class="line">设置变量的方式</span><br><span class="line">[root@newrain expect]# cat expect01.sh #!/usr/bin/expect</span><br><span class="line">set user root</span><br><span class="line">set pass 123</span><br><span class="line">set ip 192.168.62.146 </span><br><span class="line">spawn ssh $user@$ip </span><br><span class="line">expect &#123;</span><br><span class="line">        &quot;yes/no&quot; &#123; send &quot;yes\r&quot;;exp_continue &#125;</span><br><span class="line">        &quot;password:&quot; &#123; send &quot;$pass\r&quot; &#125;</span><br><span class="line">&#125;</span><br><span class="line">interact</span><br><span class="line">============================================================================</span><br><span class="line">设置位置参数的方式(拓展)</span><br><span class="line">[root@newrain expect]# cat expect01.sh </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/expect</span></span><br><span class="line">set timeout 30</span><br><span class="line">set user [ lindex $argv 0 ]</span><br><span class="line">set pass [ lindex $argv 1 ]</span><br><span class="line">set ip [ lindex $argv 2 ]S</span><br><span class="line">spawn ssh $user@$ip</span><br><span class="line"></span><br><span class="line">expect &#123;</span><br><span class="line">        &quot;yes/no&quot; &#123; send &quot;yes&quot;;exp_continue &#125;</span><br><span class="line">        &quot;password:&quot; &#123; send &quot;$pass\r&quot; &#125;</span><br><span class="line">&#125;</span><br><span class="line">interact</span><br><span class="line">运行结果为:</span><br><span class="line">[root@newrain expect]# ./expect01.sh root 123 192.168.62.146 </span><br><span class="line">spawn ssh root@192.168.62.146</span><br><span class="line">root@192.168.62.146&#x27;s password:</span><br><span class="line">Last login: Thu Aug 15 23:26:59 2019 from 192.168.62.136</span><br></pre></td></tr></table></figure>

<h5 id="例"><a href="#例" class="headerlink" title="例"></a>例</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/expect</span></span><br><span class="line">set username hello    # 定义变量   </span><br><span class="line">set passwd 1</span><br><span class="line">spawn ssh $username@172.17.138.107   # 执行交互式命令</span><br><span class="line">expect &#123;    # 捕捉系统返回，与系统进行交互</span><br><span class="line">    &quot;yes/no&quot; &#123; send &quot;yes\r&quot;;exp_continue &#125;</span><br><span class="line">    &quot;password:&quot; &#123;send &quot;$&#123;passwd&#125;\r&quot;&#125;</span><br><span class="line">&#125;</span><br><span class="line">expect  &quot;*]$&quot;   # 捕捉系统返回，与系统进行交互</span><br><span class="line">send &quot;touch /tmp/abcaaa\r&quot;</span><br><span class="line">send &quot;ls /\r&quot;</span><br><span class="line">expect eof </span><br><span class="line">interact</span><br></pre></td></tr></table></figure>

<h3 id="十五、shell-编程-运维脚本实战"><a href="#十五、shell-编程-运维脚本实战" class="headerlink" title="十五、shell 编程-运维脚本实战"></a>十五、shell 编程-运维脚本实战</h3><figure class="highlight plaintext"><figcaption><span>hell</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">• 实战项目1: 实现网络配置</span><br><span class="line">1、awk(正则) 获取到当前的ip地址，再去修改配置文件，修改的方式1、cat &gt;&gt;配置文件&lt;&lt;EOF sed 直接修改配置文件</span><br><span class="line">• 实战项目2: sed实现sshd配置</span><br><span class="line">• 实战项目3: sed实现nginx配置</span><br><span class="line">• 实战项目4: 关闭本机SELinux的功能(/etc/sysconfig/selinux)</span><br><span class="line">• 实战项目5: zabbix_agentd.conf配置文件修改（暂时不做）</span><br><span class="line">• 实战项目6: awk统计/etc/passwd各种shell数量</span><br><span class="line">• 实战项目7: awk统计网站访问各种状态数量</span><br><span class="line">• 实战项目8: awk统计访问的每个IP的数量</span><br><span class="line">• 实战项目9: 统计Nginx日志中某一天的PV量（暂时不做）</span><br><span class="line">• 实战项目10: 获取获得内存使用情况</span><br><span class="line">• 实战项目11: 基于时间的备份脚本</span><br><span class="line">• 实战项目12: Web日志访问量分析程序(PV、UV)</span><br><span class="line">• 实战项目13: 编写系统初始化脚本</span><br><span class="line">        1)设置时区并把同步时间加入计划任务</span><br><span class="line">        2)禁用selinux</span><br><span class="line">        3)历史命令显示操作时间</span><br><span class="line">        4)创建ALL权限用户并禁止root远程登录</span><br><span class="line">        5)设置最大打开文件数</span><br><span class="line">				6)减少swap使用 (将此文件/proc/sys/vm/swappiness内容修改为0) </span><br><span class="line">				7)安装常用工具</span><br><span class="line">• 实战项目14: LAMP终级部署(rpm包方式)</span><br><span class="line">• 实战项目15: Linux系统状态收集及分析(内存使用量，硬盘使用量，cpu使用量等)</span><br><span class="line"></span><br><span class="line">项目作为作业</span><br></pre></td></tr></table></figure>



<h1 id="shell-三剑客"><a href="#shell-三剑客" class="headerlink" title="shell 三剑客"></a>shell 三剑客</h1><blockquote>
<p>grep 内容的过滤</p>
<p>sed   修改、编辑配置文件</p>
<p>awk  对文件进行查看并切割，找到需要的内容</p>
</blockquote>
<h2 id="grep-指令"><a href="#grep-指令" class="headerlink" title="grep 指令"></a>grep 指令</h2><blockquote>
<p>实例1 grep 参数  “关键字” 文件</p>
<p>实例2 带有标准输出的命令 | grep 参数  “关键字”</p>
</blockquote>
<h3 id="grep-的参数"><a href="#grep-的参数" class="headerlink" title="grep 的参数"></a>grep 的参数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-E 支持扩展正则</span><br><span class="line">-P 支持perl正则</span><br><span class="line">-F 精准过滤，不支持任何特殊字符</span><br><span class="line">-v 反向过滤</span><br><span class="line">-o 只输出匹配到的内容</span><br><span class="line">-i 不区分大小写</span><br><span class="line">-c 统计匹配次数</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="sed-指令"><a href="#sed-指令" class="headerlink" title="sed 指令"></a>sed 指令</h2><blockquote>
<p>实例1 sed 参数 “需要操作的内容” 文件</p>
<p>实例2 带有标准输出的命令 | sed  参数  “关键字”</p>
</blockquote>
<h3 id="sed-的参数"><a href="#sed-的参数" class="headerlink" title="sed 的参数"></a>sed 的参数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-i.bak  -i是指在源文件中生效，.bak是可以将原来的文件备份</span><br><span class="line">-f      指定规则文件，如果规则复杂可以使用这个参数</span><br><span class="line">-n      输入的行不再输出，一般和打印p的模式一起使用</span><br><span class="line">-r      支持扩展正则符号</span><br></pre></td></tr></table></figure>



<h3 id="sed-的模式"><a href="#sed-的模式" class="headerlink" title="sed 的模式"></a>sed 的模式</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">替换：</span><br><span class="line">sed <span class="string">&#x27;s/正则匹配的原内容/要替换成的内容/g&#x27;</span> <span class="comment"># s是替换 g是全局，g也可以写为数字，表示替换第几个，也可以写3g从3替换到最后，也可以写gi 替换时不区分大小写。</span></span><br><span class="line"></span><br><span class="line">删除：</span><br><span class="line">sed <span class="string">&#x27;/正则匹配的原内容/d&#x27;</span> <span class="comment"># d 表示删除</span></span><br><span class="line">sed <span class="string">&#x27;/正则匹配的原内容/,5d&#x27;</span> <span class="comment"># 从匹配行删除到第5行</span></span><br><span class="line">sed <span class="string">&#x27;/正则匹配的原内容/,$d&#x27;</span> <span class="comment"># 从匹配行删除到最后</span></span><br><span class="line">sed <span class="string">&#x27;1,/正则匹配的原内容/d&#x27;</span></span><br><span class="line">sed <span class="string">&#x27;/正则匹配的原内容/,/写一个匹配行/d&#x27;</span></span><br><span class="line">sed <span class="string">&#x27;1,5d&#x27;</span> <span class="comment"># 从第一行删除到第5行</span></span><br><span class="line">sed <span class="string">&#x27;1~2d&#x27;</span> <span class="comment"># 删除1、3、5行</span></span><br><span class="line"></span><br><span class="line">打印：</span><br><span class="line">sed -n <span class="string">&#x27;/匹配内容/p&#x27;</span> <span class="comment"># 打印匹配到的内容，-n是输入行不再输出</span></span><br><span class="line"></span><br><span class="line">插入:</span><br><span class="line">sed <span class="string">&#x27;/匹配到的内容/a\要追加的内容&#x27;</span></span><br><span class="line">sed <span class="string">&#x27;/匹配到的内容/i\要插入的内容&#x27;</span> <span class="comment"># 插入 i 追加 a </span></span><br></pre></td></tr></table></figure>



<h2 id="awk-指令"><a href="#awk-指令" class="headerlink" title="awk 指令"></a>awk 指令</h2><blockquote>
<p>实例1 awk 参数 “对内容的操作模式” 文件</p>
<p>实例2 带有标准输出的命令 | awk  参数  “对内容的操作模式”</p>
</blockquote>
<h3 id="awk-的参数"><a href="#awk-的参数" class="headerlink" title="awk 的参数"></a>awk 的参数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-F 指定输入字段分隔符</span><br><span class="line">-f 指定规则文件</span><br><span class="line">-v 可以给表达式传递变量</span><br></pre></td></tr></table></figure>



<h3 id="awk-的符号"><a href="#awk-的符号" class="headerlink" title="awk 的符号"></a>awk 的符号</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">NR 行号</span><br><span class="line">NF 列的数量</span><br><span class="line">FNR 不同文件分开行号</span><br><span class="line">列的分隔符：</span><br><span class="line">FS 输入字段分隔符  空格或tab</span><br><span class="line">OFS 输出字段分隔符 空格</span><br><span class="line">行的分隔符：</span><br><span class="line">RS 输入记录分隔符  换行</span><br><span class="line">ORS 输出记录分隔符 换行</span><br></pre></td></tr></table></figure>



<h3 id="awk-的阶段"><a href="#awk-的阶段" class="headerlink" title="awk 的阶段"></a>awk 的阶段</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;BEGIN&#123;一般是在处理数据之前可以做的事情，例如，初始化一些变量，或者打印一些内容&#125;&#123;文件中的每一行都会调用这一块&#125;END&#123;一般是输出一些内容，或将计算结果进行处理并输出&#125;&#x27;</span></span><br></pre></td></tr></table></figure>



<h3 id="awk-的特殊语法"><a href="#awk-的特殊语法" class="headerlink" title="awk 的特殊语法"></a>awk 的特殊语法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;&#123;if($NF &lt;= 2000)&#123;print &quot;真完蛋&quot;,$NF&#125; else&#123;print &quot;还可以&quot;,$NF&#125;&#125;&#x27;</span> data.txt</span><br><span class="line"></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;for(i=0;i&lt;100;i++)&#123;print i&#125;&#125;&#x27;</span> data.txt</span><br><span class="line"></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot;:&quot;&#125;&#123;shells[$NF]++&#125;END&#123;for(i in shells)&#123;print i,shells[i]&#125;&#125;&#x27;</span> /etc/passwd</span><br></pre></td></tr></table></figure>






    </article>
    
    <div class="read-nums">
      <!-- id 将作为查询条件 -->
      <span id="2023/07/21/shell_newrain/" class="leancloud_visitors" data-flag-title="Your Article Title">
        <em class="post-meta-item-text">浏览量</em>
        <i class="leancloud-visitors-count"></i>
      </span>
    </div>
    <div class="comments-intro">
      <h2>评论区</h2>
      <p>欢迎你留下宝贵的意见，昵称输入QQ号会显示QQ头像哦~</p>
    </div>
    <div id="vcomments" class="vcomments"></div>
    
  </div>
  <div class="article-catelogue">
    <div class="article-catelogue--wrapper">
      <div class="catelogue catelogue-1">
        <h3>目录</h3>
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#shell%E7%BC%96%E7%A8%8B"><span class="toc-number">1.</span> <span class="toc-text">shell编程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%88%9D%E8%AF%86shell"><span class="toc-number">1.0.1.</span> <span class="toc-text">一、初识shell</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#shell-%E5%AE%9A%E4%B9%89"><span class="toc-number">1.0.1.0.1.</span> <span class="toc-text">shell 定义</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#shell%E7%9A%84%E5%88%86%E7%B1%BB%E5%92%8C%E5%88%87%E6%8D%A2"><span class="toc-number">1.0.1.0.2.</span> <span class="toc-text">shell的分类和切换</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.0.1.0.3.</span> <span class="toc-text">使用场景</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#shell-%E7%89%B9%E6%80%A7%E5%9B%9E%E9%A1%BE"><span class="toc-number">1.0.1.0.4.</span> <span class="toc-text">shell 特性回顾</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#bash-%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">1.0.1.0.5.</span> <span class="toc-text">bash 初始化</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81shell-%E8%84%9A%E6%9C%AC%E8%A7%84%E8%8C%83"><span class="toc-number">1.0.2.</span> <span class="toc-text">二、shell 脚本规范</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%8F%98%E9%87%8F%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.0.3.</span> <span class="toc-text">三、变量的类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BB%83%E4%B9%A01"><span class="toc-number">1.0.3.0.1.</span> <span class="toc-text">练习1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BB%83%E4%B9%A02"><span class="toc-number">1.0.3.0.2.</span> <span class="toc-text">练习2</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E8%84%9A%E6%9C%AC%E8%BF%90%E8%A1%8C"><span class="toc-number">1.0.4.</span> <span class="toc-text">四、脚本运行</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAbash%E8%84%9A%E6%9C%AC%EF%BC%88shell%E8%84%9A%E6%9C%AC%EF%BC%89"><span class="toc-number">1.0.4.0.1.</span> <span class="toc-text">创建bash脚本（shell脚本）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#bash%E8%84%9A%E6%9C%AC%E6%89%A7%E8%A1%8C"><span class="toc-number">1.0.4.0.2.</span> <span class="toc-text">bash脚本执行</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AD%90shell"><span class="toc-number">1.0.4.0.3.</span> <span class="toc-text">子shell</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#bash-%E8%84%9A%E6%9C%AC%E6%B5%8B%E8%AF%95"><span class="toc-number">1.0.4.0.4.</span> <span class="toc-text">bash 脚本测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%8F%98%E9%87%8F%E7%BD%AE%E6%8D%A2"><span class="toc-number">1.0.5.</span> <span class="toc-text">五、变量置换</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%9B%BF%E6%8D%A2"><span class="toc-number">1.0.5.0.1.</span> <span class="toc-text">命令替换</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%98%E9%87%8F%E6%9B%BF%E6%8D%A2"><span class="toc-number">1.0.5.0.2.</span> <span class="toc-text">变量替换</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%98%E9%87%8F%E6%9B%BF%E6%8D%A2-%E5%8C%B9%E9%85%8D%E6%88%AA%E5%8F%96"><span class="toc-number">1.0.5.0.3.</span> <span class="toc-text">变量替换-匹配截取</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#basename-dirname"><span class="toc-number">1.0.5.0.4.</span> <span class="toc-text">basename &amp; dirname</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AD%E3%80%81shell%E7%BC%96%E7%A8%8B-%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6"><span class="toc-number">1.0.6.</span> <span class="toc-text">六、shell编程-流程控制</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#shell%E7%BC%96%E7%A8%8B-%E6%9D%A1%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="toc-number">1.0.6.0.1.</span> <span class="toc-text">shell编程-条件结构</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#shell%E5%88%86%E6%94%AFif%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.0.6.0.2.</span> <span class="toc-text">shell分支if语句</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A1"><span class="toc-number">1.0.6.0.3.</span> <span class="toc-text">作业1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#shell-%E5%88%86%E6%94%AFcase%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.0.6.0.4.</span> <span class="toc-text">shell 分支case语句</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%83%E3%80%81shell%E7%BC%96%E7%A8%8B-%E5%BE%AA%E7%8E%AF%E7%BB%93%E6%9E%84"><span class="toc-number">1.0.7.</span> <span class="toc-text">七、shell编程-循环结构</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#shell%E5%BE%AA%E7%8E%AF-for%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.0.7.0.1.</span> <span class="toc-text">shell循环-for语句</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#shell-%E5%BE%AA%E7%8E%AFwhile%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.0.7.0.2.</span> <span class="toc-text">shell 循环while语句</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#shell%E5%BE%AA%E7%8E%AFuntil%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.0.7.0.3.</span> <span class="toc-text">shell循环until语句</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#shell-%E5%BE%AA%E7%8E%AF%E6%8E%A7%E5%88%B6shift%E3%80%81continue%E3%80%81break%E3%80%81exit"><span class="toc-number">1.0.7.0.4.</span> <span class="toc-text">shell 循环控制shift、continue、break、exit</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9E%E6%88%98-shell%E7%89%88%E6%9C%ACjumpserver%E5%BC%80%E5%8F%91-%E5%A0%A1%E5%9E%92%E6%9C%BA"><span class="toc-number">1.0.7.0.5.</span> <span class="toc-text">实战-shell版本jumpserver开发(堡垒机)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AB%E3%80%81shell-%E7%BC%96%E7%A8%8B-%E5%87%BD%E6%95%B0"><span class="toc-number">1.0.8.</span> <span class="toc-text">八、shell 编程-函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#shell-%E5%87%BD%E6%95%B0function"><span class="toc-number">1.0.8.0.1.</span> <span class="toc-text">shell 函数function</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B9%9D%E3%80%81shell-%E7%BC%96%E7%A8%8B-%E6%95%B0%E7%BB%84"><span class="toc-number">1.0.9.</span> <span class="toc-text">九、shell 编程-数组</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B0%E7%BB%84%E5%AE%9A%E4%B9%89"><span class="toc-number">1.0.9.0.1.</span> <span class="toc-text">数组定义</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%95%B0%E7%BB%84"><span class="toc-number">1.0.9.0.2.</span> <span class="toc-text">访问数组</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%81%E3%80%81%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8FRE"><span class="toc-number">1.0.10.</span> <span class="toc-text">十、正则表达式RE</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#No-1-%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%9F%BA%E6%9C%AC%E5%85%83%E5%AD%97%E7%AC%A6"><span class="toc-number">1.0.10.0.1.</span> <span class="toc-text">No.1 正则表达式基本元字符</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#No-2%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%8B%93%E5%B1%95%E5%85%83%E5%AD%97%E7%AC%A6"><span class="toc-number">1.0.10.0.2.</span> <span class="toc-text">No.2正则表达式拓展元字符</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%81%E4%B8%80%E3%80%81shell-%E7%BC%96%E7%A8%8B-grep"><span class="toc-number">1.0.11.</span> <span class="toc-text">十一、shell 编程-grep</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%81%E4%BA%8C%E3%80%81shell-%E7%BC%96%E7%A8%8B-SED"><span class="toc-number">1.0.12.</span> <span class="toc-text">十二、shell 编程-SED</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#sed%E6%B5%81%E7%BC%96%E8%BE%91%E5%99%A8%E7%94%A8%E6%B3%95%E5%8F%8A%E8%A7%A3%E6%9E%90"><span class="toc-number">1.0.12.0.1.</span> <span class="toc-text">sed流编辑器用法及解析</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%81%E4%B8%89%E3%80%81shell-%E7%BC%96%E7%A8%8B-AWK"><span class="toc-number">1.0.13.</span> <span class="toc-text">十三、shell 编程-AWK</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#AWK%E4%BD%BF%E7%94%A8%E7%90%86%E8%A7%A3%E6%A1%88%E4%BE%8B"><span class="toc-number">1.0.13.0.1.</span> <span class="toc-text">AWK使用理解案例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%81%E5%9B%9B%E3%80%81shell-%E7%BC%96%E7%A8%8B-Expect"><span class="toc-number">1.0.14.</span> <span class="toc-text">十四、shell 编程-Expect</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#No-1-expect%E7%9A%84%E5%AE%89%E8%A3%85"><span class="toc-number">1.0.14.0.1.</span> <span class="toc-text">No.1 expect的安装</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#No-2-expect%E7%9A%84%E8%AF%AD%E6%B3%95"><span class="toc-number">1.0.14.0.2.</span> <span class="toc-text">No.2 expect的语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BE%8B"><span class="toc-number">1.0.14.0.3.</span> <span class="toc-text">例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%81%E4%BA%94%E3%80%81shell-%E7%BC%96%E7%A8%8B-%E8%BF%90%E7%BB%B4%E8%84%9A%E6%9C%AC%E5%AE%9E%E6%88%98"><span class="toc-number">1.0.15.</span> <span class="toc-text">十五、shell 编程-运维脚本实战</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#shell-%E4%B8%89%E5%89%91%E5%AE%A2"><span class="toc-number">2.</span> <span class="toc-text">shell 三剑客</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#grep-%E6%8C%87%E4%BB%A4"><span class="toc-number">2.1.</span> <span class="toc-text">grep 指令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#grep-%E7%9A%84%E5%8F%82%E6%95%B0"><span class="toc-number">2.1.1.</span> <span class="toc-text">grep 的参数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sed-%E6%8C%87%E4%BB%A4"><span class="toc-number">2.2.</span> <span class="toc-text">sed 指令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sed-%E7%9A%84%E5%8F%82%E6%95%B0"><span class="toc-number">2.2.1.</span> <span class="toc-text">sed 的参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sed-%E7%9A%84%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.2.2.</span> <span class="toc-text">sed 的模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#awk-%E6%8C%87%E4%BB%A4"><span class="toc-number">2.3.</span> <span class="toc-text">awk 指令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#awk-%E7%9A%84%E5%8F%82%E6%95%B0"><span class="toc-number">2.3.1.</span> <span class="toc-text">awk 的参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#awk-%E7%9A%84%E7%AC%A6%E5%8F%B7"><span class="toc-number">2.3.2.</span> <span class="toc-text">awk 的符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#awk-%E7%9A%84%E9%98%B6%E6%AE%B5"><span class="toc-number">2.3.3.</span> <span class="toc-text">awk 的阶段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#awk-%E7%9A%84%E7%89%B9%E6%AE%8A%E8%AF%AD%E6%B3%95"><span class="toc-number">2.3.4.</span> <span class="toc-text">awk 的特殊语法</span></a></li></ol></li></ol></li></ol>
      </div>
      
        <div class="catelogue catelogue-2">
          
            <p>
              <span>上一篇：</span>
              <a href="/2023/09/17/ansible 模块扩展/">ansible模块</a>
            </p>
           
          
            <p>
              <span>下一篇</span>
              <a href="/2023/07/11/磁盘阵列RAID/">磁盘阵列</a>
            </p>
          
        </div>
      
    </div>
  </div>
</div>


<script>
  // var定义，避免pjax重新进来造成的重复声明错误
  var config = JSON.parse('{"enable":true,"appId":"Pf8zCXGEH1qsprnWfikVVujL-gzGzoHsz","appKey":"qOqoiUHhH1TGtLRUYURkLRQX","placeholder":"请留下你宝贵的意见吧~","meta":["nick"],"recordIP":true,"visitor":true,"enableQQ":true}')
  new Valine({
    el: '#vcomments',
    appId: config.appId,
    appKey: config.appKey,
    placeholder: config.placeholder,
    meta: config.meta,
    recordIP: config.recordIP,
    visitor: config.visitor,
    enableQQ: config.enableQQ,
    path: '2023/07/21/shell_newrain/'
  })
</script>


<script>
  $(document).on('pjax:complete', function() {
    const tocs = document.querySelector('.toc')
    const links = tocs ? tocs.querySelectorAll('a') : []
    links.forEach(link => {
      link.addEventListener('click', e => {
        const href = decodeURIComponent(e.href)
        href.search(/#(.*)/)
        const id = RegExp.$1
        const target = document.querySelector('#' + id)
        const top = target.offsetTop
        document.documentElement.scrollTo({
          top: top - 100,
          behavior: 'smooth'
        })
        e.preventDefault()
      })
    })
  })
</script> 

</div>
      <div class="main-right-wrapper"><div class="main-right">
  <div class="main-right--board">
    <div class="main-right--title">
      <h5>公告栏</h5>
      <i class="iconfont icon-gonggao"></i>
    </div>
    <div class="main-right--content">
      Hello~大噶好。唔系小曹宅，欢迎你们来到我的博客小站，希望能在这里收获到有用的东西哦！ 
    </div>
  </div>

  <div id="aplayer" class="main-right--music"></div>

  <div class="operate-items">
    <div class="operate-item backtop">
      <i class="iconfont icon-huidaodingbu"></i>
      <span>回到顶部</span>
    </div>
    
    <div class="operate-item turn-comment hidden">
      <i class="iconfont icon-pinglun"></i>
      <span>查看评论</span>
    </div>
    
  </div>

  <div class="main-right--site">
    <div class="main-right--power">
      <p>Power By <a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/docs/">Hexo</a>.</p>
      <p>Theme：<a target="_blank" rel="noopener" href="https://github.com/Aizener/hexo-theme-cola">Cola.</a></p>
    </div>
    <p class="main-right--refer"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/#/Integrated/index">2262690094</a> </p>
  </div>
</div>

<script>
  function setOperateItem () {
    const reg = /\d{4}\/\d{2}\/\d{2}\/.+/
    const path = location.pathname
    const operateDom = document.querySelector('.main-right .operate-items')
    const commentDom = document.querySelector('.turn-comment')
    const cateloguDom = document.querySelector('.article-catelogue > .article-catelogue--wrapper');

    if (commentDom) {
      if (reg.test(path) || path.match(/\/log\/.+/)) {
        commentDom.classList.remove('hidden')
        const newDom = operateDom.cloneNode(true);
        const _backtopDom = newDom.querySelector('.backtop');
        const _commentDom = newDom.querySelector('.turn-comment');
        _backtopDom.addEventListener('click', () => backTopEvent());
        _commentDom.addEventListener('click', () => commentDomEvent());
        cateloguDom.appendChild(newDom);
      } else {
        commentDom.classList.add('hidden')
      }
    }
  }

  setOperateItem()
  const musics = JSON.parse(`[{"name":"不找了","artist":"隔壁老樊","url":"music/隔壁老樊 - 不找了.mp3","cover":"https://img2.baidu.com/it/u=1260056724,1076343118&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500"},{"name":"于是天气刚好","artist":"泪桥","url":"music/于是天气刚好 - 泪桥.mp3","cover":"https://img2.baidu.com/it/u=705831265,2862720033&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500"},{"name":"安和桥","artist":"林芬宇","url":"music/林芬宇 - 安和桥.mp3","cover":"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQo0SWQx6YrNA8lElaG4OOKLkNkNzLO1PflKg&usqp=CAU"}]`)
  const ap = new APlayer({
    container: document.querySelector('#aplayer'),
    audio: musics,
  })

  $(document).on('pjax:complete', function() {
    setOperateItem()
  })

  document.querySelector('.backtop').addEventListener('click', () => {
    backTopEvent();
  })
  const dom = document.querySelector('.turn-comment')
  dom && dom.addEventListener('click', () => {
    commentDomEvent();
  })

  function backTopEvent() {
    document.documentElement.scrollTo({
      top: 0,
      behavior: 'smooth'
    })
  }

  function commentDomEvent() {
    const commentDom = document.querySelector('.comments-intro')
    if (!commentDom) return
    const top = commentDom.offsetTop, height = commentDom.offsetHeight
    document.documentElement.scrollTo({
      top: top - 2 * height,
      behavior: 'smooth'
    })
  }
</script></div>
    </section>
  </div>
  <div id="progress" class="progress"></div>
  <div id="gray" class="gray"></div>

  <script>
    function initScroll () {
      document.addEventListener('scroll', () => {
        const doc = document.documentElement
        const scrollTop = doc.scrollTop
        const pageHeight = doc.offsetHeight
        const clientHeight = doc.clientHeight
        const ratio = scrollTop / (pageHeight - clientHeight)
        const progress = document.querySelector('#progress')
        const avatarImg = document.querySelector('.main-left--avatar')
        progress.style.width = (100 * ratio) + '%'
        avatarImg.style.transform = `rotate(${360 * ratio}deg)`
      })
    }

    const rootPath = "/"

    const checkAndSetArticlePageLayout = () => {
      const path = location.pathname.replace(rootPath, '');
      if (
        /^\/?\d{4}\/\d{2}\/\d{2}\/.*/.test(path) ||
        /^log\/.+/.test(path)
      ) {
        $('.main-container, .main-right, .main-right-wrapper').addClass('is-article')
      } else {
        $('.main-container, .main-right, .main-right-wrapper').removeClass('is-article')
      }
    }

    const gray = "none"
    const setGrayStyle = () => {
      if (gray === 'none') {
        return
      } else if (gray === 'index') {
        location.pathname === '/' ? $('#gray').show() : $('#gray').hide()
      } else if (gray === 'all') {
        $('#gray').show()
      }
    }
    setGrayStyle()


    window.onload = function () {
      checkAndSetArticlePageLayout()
      setTimeout(() => {
        $('#load').slideUp()
        $('#container').slideToggle()
        setTimeout(() => {
          initScroll();
        }, 500)
      }, 500)
    }
    
    let status = 0
    // 对所有链接跳转事件绑定pjax容器container
    $(document).pjax('a[target!=_blank]', '#main-container', {
      container: '#main-container',
      fragment: '#main-container',
      timeout: 8000
    })

    $(document).on('pjax:start', function() {
    })
    $(document).on('pjax:complete', function() {
      status = 0
      $('.main-container').addClass('to-up').on('animationend', function() {
        $(this).removeClass('to-up')
      })
      setGrayStyle()
      checkAndSetArticlePageLayout()
    })
    $(document).on('pjax:popstate', function() {
      status = -1
      checkAndSetArticlePageLayout()
    });
  </script>
</body>
</html>